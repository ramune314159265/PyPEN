"use strict";const typeOfValue={typeInt:1,typeFloat:2,typeString:3,typeBoolean:4,typeArray:5};var graphColor=["#c00000","#00c000","#0000c0","#007070","#700070","#707000"];const nameOfType=["","整数","実数","文字列","真偽","配列"];var code=null,varTables=[],myFuncs={},returnValues=[],run_flag=!1,step_flag=!1,editable_flag=!0,flowchart=null,textarea=null,context=null,current_line=-1,wait_time=0,flowchart_display=!1,converting=!1,dirty=null,timeouts=[],selected_quiz=-1,selected_quiz_case=-1,selected_quiz_input=0,selected_quiz_output=0,output_str="",test_limit_time=0,fontsize=16,python_lib={},editor=null;function finish(){selected_quiz<0&&textareaAppend("---\n"),highlightLine(-1),setRunflag(!1),wait_time=0,code=null}class parsedCode{constructor(statementlist){this.stack=[{statementlist:statementlist,index:0}]}makePython(){python_lib={};for(var code="",libs="",i=0;i<this.stack[0].statementlist.length;i++){var state;(state=this.stack[0].statementlist[i])&&(state instanceof DefineFunction||state instanceof DefineStep)&&(code+=state.makePython(0))}for(var i=0;i<this.stack[0].statementlist.length;i++){var state;(state=this.stack[0].statementlist[i])&&!(state instanceof DefineFunction||state instanceof DefineStep)&&(code+=state.makePython(0))}for(var lib in python_lib)libs+="import "+lib+"\n";return libs+code}}class parsedMainRoutine extends parsedCode{constructor(statementlist){super(statementlist)}}class parsedFunction extends parsedCode{constructor(statementlist){super(statementlist)}}class parsedStep extends parsedCode{constructor(statementlist){super(statementlist)}}class varTable{constructor(){this.vars={}}findVarTable(varname){return this.vars[varname]?this:null}varnames(oldvars){var names=oldvars;for(var name in this.vars)names.indexOf(name)<0&&names.push(name);return names.sort()}}function findVarTable(varname){var t=varTables[0].findVarTable(varname);return t||null}function codeChange(){if(!converting&&flowchart_display){var code=editor.getValue()+"\n";textarea.value="";try{myFuncs={};for(var dncl_code=python_to_dncl(code),parse=dncl.parse(dncl_code),flag=!1,i=0;i<parse.length;i++)(parse[i]instanceof DefineFunction||parse[i]instanceof DefineStep)&&(flag=!0);if(flag)return void(textarea.value="関数定義や手続き定義のあるプログラムのフローチャートはまだ実装していません。\n");converting=!0,flowchart.code2flowchart(parse),converting=!1}catch(e){highlightLine(-1),textareaClear(),e.line&&textareaAppend(e.line+"行目"),textareaAppend(`構文エラーです\n${e.message}\n`),converting=!1}}}function isFinite(v){return!isNaN(v)&&v!=Number.POSITIVE_INFINITY&&v!=Number.NEGATIVE_INFINITY}function isSafeInteger(v){return!isNaN(v)&&v==Math.floor(v)&&v<=9007199254740991&&v>=-9007199254740991}function isInteger(v){return isFinite(v)&&v==Math.floor(v)}function constructor_name(obj){var result=/^(class|function)\s+([\w\d]+)/.exec(obj.constructor.toString());return result?result[2]:null}function toHalf(s,loc){if(s=s.toString(),1==setting.zenkaku_mode&&/[Ａ-Ｚａ-ｚ０-９．−]/.exec(s))throw new RuntimeError(loc.first_line,"数値や変数名を全角文字で入力してはいけません");return s.replace(/[Ａ-Ｚａ-ｚ０-９．−]/g,(function(s){return String.fromCharCode(s.charCodeAt(0)-65248)}))}function makeDirty(b){b!==dirty&&(dirty=b,document.getElementById("dirty").style.visibility=dirty?"visible":"hidden")}function textareaAppend(v){textarea.value+=v,textarea.scrollTop=textarea.scrollHeight}function textareaClear(){textarea.value=""}class Location{constructor(first_token,last_token){this._first_line=first_token.first_line,this._last_line=last_token.last_line}get first_line(){return this._first_line}get last_line(){return this._last_line}}class RuntimeError{constructor(line,message){this._line=line,this._message=message,setRunflag(!1)}get line(){return this._line}get message(){return this._message}}class Value{constructor(v,loc){this.rtnv=this._value=v,this._loc=loc}clone(){throw new RuntimeError(this.first_line,constructor_name(this)+"はcloneが作られていません")}get value(){return this._value}get loc(){return this._loc}get first_line(){return this._loc.first_line}getValue(){return this}getCode(){return""+this._value}makePython(){return this.getCode()}run(){code[0].stack[0].index++}}class NullValue extends Value{constructor(loc){super(null,loc)}clone(){return new NullValue(this.loc)}getValue(){return this}makePython(){return""}}function setVariableByArgs(vt,vn,args,newval,loc){if(args){for(var v=vt.vars[vn],i=0;i<args.length-1;i++){var arg;if((arg=args.getValue().value[i]).getValue()instanceof IntValue){if(!(v.getValue()instanceof ArrayValue||v.getValue()instanceof StringValue))throw v.getValue()instanceof StringValue?new RuntimeError(loc.first_line,"部分文字列の部分文字列への代入はできません"):new RuntimeError(loc.first_line,"整数の添字は配列か文字列でないと使えません");var idx=arg.getValue().value,l=v.getValue().length;if(idx<0&&(idx+=l),!(idx>=0&&idx<l))throw new RuntimeError(loc.first_line,"配列の範囲を超えて代入しようとしました");v=v.getValue().value[idx]}else{if(!(arg.getValue()instanceof StringValue))throw arg.getValue()instanceof SliceValue?new RuntimeError(loc.first_line,"スライスの使い方が正しくありません"):new RuntimeError(loc.first_line,"添字が正しくありません");var key0=arg.getValue().value;if(!(v.getValue()instanceof DictionaryValue))throw new RuntimeError(loc.first_line,"文字列の添字は辞書でないと使えません");for(var key in v.getValue().value)if(key==key0){v=v.getValue().value[key0],key0=null;break}if(key0)throw new RuntimeError(loc.first_line,"辞書にキー"+arg.getValue().value+"がありません")}}var arg;if((arg=args.getValue().value[args.length-1]).getValue()instanceof IntValue){var idx=arg.getValue().value,l=v.getValue().value.length;if(idx<0&&(idx+=l),idx<0||idx>=l)throw new RuntimeError(loc.first_line,"配列の範囲を超えて代入しようとしました");if(v.getValue()instanceof ArrayValue)v.getValue().value[idx]=newval.clone();else{if(!(v.getValue()instanceof StringValue))throw new RuntimeError(loc,"整数の添字は配列か文字列にしか使えません");if(!(newval.getValue()instanceof StringValue))throw new RuntimeError(loc.first_line,"文字列の途中に文字列でないものを挿入しようとしました");var str=v.getValue().value;v.getValue()._value=str.substr(0,idx)+newval.getValue()._value+str.substr(idx+1)}}else if(arg.getValue()instanceof StringValue){if(!(v.getValue()instanceof DictionaryValue))throw new RuntimeError(loc.first_line,"文字列の添字は辞書にしか使えません");v.getValue().value[arg.getValue().value]=newval.clone()}else{if(!(arg.getValue()instanceof SliceValue))throw new RuntimeError(loc.first_line,"添字が正しくありません");var idx1=arg.getValue1().value,idx2=arg.getValue2().value;if(v.getValue()instanceof ArrayValue){if(!(newval.getValue()instanceof ArrayValue))throw new RuntimeError(loc.first_line,"配列に配列でないものを挿入しようとしました");var l=v.getValue().length;if(idx1||(idx1=0),idx2||(idx2=l),idx1<0&&(idx1+=l),idx2<0&&(idx2+=l),!(idx1>=0&&idx2>=0&&idx1<l&&idx2<l))throw new RuntimeError(loc.first_line,"配列の範囲外に挿入しようとしました");for(var a=[],i=0;i<idx1;i++)a.push(v.getValue().value[i].clone());for(var i=0;i<newval.getValue().length;i++)a.push(newval.getValue().value[i].clone());for(var i=idx2;i<l;i++)a.push(v.getValue().value[i].clone());v.getValue()._value=a}else{if(!(v.getValue()instanceof StringValue))throw new RuntimeError("スライスの添字は配列か文字列でないと使えません");if(!(newval.getValue()instanceof StringValue))throw new RuntimeError(loc.first_line,"文字列の途中に文字列でないものを挿入しようとしました");var l=v.getValue().length;if(idx1||(idx1=0),idx2||(idx2=l),idx1<0&&(idx1+=l),idx2<0&&(idx2+=l),idx1>=0&&idx2>=0&&idx1<l&&idx2<l){var str=v.getValue().value.substr(0,idx1)+newval.getValue().value+v.getValue().value.substr(idx2);v.getValue()._value=str}}}}else vt.vars[vn]=newval.clone()}function getValueByArgs(v,args,loc){if(args)for(var i=0;i<args.length;i++){var arg=args.getValue().value[i];if(arg.getValue()instanceof IntValue)if(v.getValue()instanceof ArrayValue){var idx=arg.getValue().value,l=v.getValue().length;if(idx<0&&(idx+=l),!(idx>=0&&idx<l))throw new RuntimeError(loc.first_line,"配列の範囲を超えてアクセスしました");v=v.getValue().value[idx]}else{if(!(v.getValue()instanceof StringValue))throw new RuntimeError(loc.first_line,"整数の添字は配列か文字列でないと使えません");var idx=arg.getValue().value,l=v.getValue().length;if(idx<0&&(idx+=l),!(idx>=0&&idx<l))throw new RuntimeError(loc.first_line,"文字列の範囲を超えてアクセスしました");v=new StringValue(v.getValue().value[idx],loc)}else if(arg.getValue()instanceof StringValue){if(!(v.getValue()instanceof DictionaryValue))throw new RuntimeError(loc.first_line,"文字列の添字は辞書でないと使えません");v=v.getValue().value[arg.getValue().value]}else{if(!(arg.getValue()instanceof SliceValue))throw new RuntimeError(loc.first_line,"添字が正しくありません");var idx1=arg.getValue1().value,idx2=arg.getValue2().value;if(v.getValue()instanceof ArrayValue){var l=v.getValue().length;if(idx1||(idx1=0),idx2||(idx2=l),idx1<0&&(idx1+=l),idx2<0&&(idx2+=l),!(idx1>=0&&idx2>=0&&idx1<=l&&idx2<=l))throw new RuntimeError(loc.first_line,"配列の範囲を超えて読み出そうとしました");for(var a=[],j=idx1;j<idx2;j++)a.push(v.getValue().value[j].clone());v=new ArrayValue(a,loc)}else{if(!(v.getValue()instanceof StringValue))throw new RuntimeError(loc.first_line,"スライスの添字は配列か文字列でないと使えません");var l=v.getValue().length;if(idx1||(idx1=0),idx2||(idx2=l),idx1<0&&(idx1+=l),idx2<0&&(idx2+=l),!(idx1>=0&&idx2>=0&&idx1<=l&&idx2<=l))throw new RuntimeError(loc.first_line,"文字列の範囲を超えて読み出そうとしました");v=new StringValue(v.getValue().value.substr(idx1,idx2-idx1),loc)}}}return v.clone()}class ArrayValue extends Value{constructor(v,loc){super(v,loc),this.rtnv=v}clone(){for(var a=[],i=0;i<this.value.length;i++)a.push(this.value[i].getValue().clone());var rtnv;return new ArrayValue(a,this.loc)}run(){for(var a=[],i=0;i<this.value.length;i++)a.push(this.value[i].getValue().clone());this.rtnv=a,super.run()}getCode(){for(var ag=[],i=0;i<this.value.length;i++)ag.push(this.value[i].getCode());return"["+ag.join(",")+"]"}makePython(){for(var ag=[],i=0;i<this.value.length;i++)ag.push(this.value[i].makePython());return"["+ag.join(",")+"]"}get length(){return this._value.length}getValue(){return this}append(a){this._value=this.value.concat(a)}}class DictionaryValue extends Value{constructor(v,loc){super({},loc);for(var i=0;i<v.length;i++){if(!(v[i]instanceof SliceValue&&v[i].getValue1()instanceof StringValue)||v[i].getValue2()instanceof NullValue)throw new RuntimeError(loc.first_line,"辞書の初期化が間違っています");this.value[v[i].getValue1().value]=v[i].getValue2()}}clone(){for(var rtnv=new DictionaryValue({},this.loc),keys=Object.keys(this.value),i=0;i<keys.length;i++){if(!this.value[keys[i]])throw new RuntimeError(this.first_line,keys[i]+"が定義されていません");rtnv.getValue().value[keys[i]]=this.value[keys[i]].getValue().clone()}return rtnv}getCode(){var ag=[],keys=Object.keys(this.value);keys.sort();for(var i=0;i<keys.length;i++)ag.push(keys[i]+":"+this.value[keys[i]].getCode());return"{"+ag.join(",")+"}"}makePython(){var ag=[],keys=Object.keys(this.value);keys.sort();for(var i=0;i<keys.length;i++)ag.push("'"+keys[i]+"':"+this.value[keys[i]].makePython());return"{"+ag.join(",")+"}"}getValue(){return this}}function makeArray(size,args,loc,type){let depth=size.value.length;if(args.length!=depth){let v=[];args||(args=[]);for(let i=0;i<size.value[args.length].value;i++)args.push(i),v.push(makeArray(size,args,loc,type)),args.pop();return new ArrayValue(v,loc)}switch(type){case typeOfValue.typeInt:return new IntValue(0,loc);case typeOfValue.typeFloat:return new FloatValue(0,loc);case typeOfValue.typeString:return new StringValue("",loc);case typeOfValue.typeBoolean:return new BooleanValue(!0,loc)}}class IntValue extends Value{constructor(v,loc){if(super(v,loc),!isSafeInteger(v))throw new RuntimeError(this.first_line,"整数で表せない値です");this.rtnv=this.value}clone(){var rtnv=new IntValue(this.value,this.loc);return rtnv.rtnv=this.rtnv,rtnv}getValue(){return this}}class FloatValue extends Value{constructor(v,loc){if(super(v,loc),!isFinite(v))throw new RuntimeError(this.first_line,"オーバーフローしました");this.rtnv=this.value}clone(){var rtnv=new FloatValue(this.value,this.loc);return rtnv.rtnv=this.rtnv,rtnv}getCode(){let str=this.value.toString();return null!=str.match(/[Ee]/)?str:isInteger(this.value)?this.value+".0":this.value}getValue(){return this}}class StringValue extends Value{constructor(v,loc){super(v,loc),this.rtnv=this.value}clone(){var rtnv=new StringValue(this.value,this.loc);return rtnv.rtnv=this.rtnv,rtnv}getCode(){return'"'+this.value.replace(/"/g,'\\"')+'"'}get length(){return this.value.length}makePython(){return"'"+this.value.replace("'","\\'")+"'"}getValue(){return this}}class BooleanValue extends Value{constructor(v,loc){super(v,loc),this.rtnv=this.value}clone(){var rtnv=new BooleanValue(this.value,this.loc);return rtnv.rtnv=this.rtnv,rtnv}getCode(){return this.value?"True":"False"}makePython(){return this.value?"True":"False"}getValue(){return this}}class UNDEFINED extends Value{constructor(v,loc){super(v,loc)}clone(){return new UNDEFINED(this.value,this.loc)}get varname(){return this.value}getValue(){throw new RuntimeError(this.first_line,"未完成のプログラムです")}getCode(){return this.value}}class Pow extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new Pow(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof IntValue&&v2 instanceof IntValue&&v2.value>=0){if(0==v1.value&&v2.value<=0)throw new RuntimeError(this.first_line,"0は正の数乗しかできません");let v=Math.pow(v1.value,v2.value);if(!isSafeInteger(v))throw new RuntimeError(this.first_line,"整数で表せる範囲を越えました");this.rtnv=new IntValue(v,this.loc)}else{if(!(v1 instanceof IntValue||v1 instanceof FloatValue)||!(v2 instanceof IntValue||v2 instanceof FloatValue))throw new RuntimeError("数値でないもののべき乗はできません");{if(v1.value<0&&!Number.isInteger(v2.value))throw new RuntimeError(this.first_line,"負の数の非整数乗はできません");if(0==v1.value&&v2.value<=0)throw new RuntimeError(this.first_line,"0は正の数乗しかできません");let v=Math.pow(v1.value,v2.value);if(!isFinite(v))throw new RuntimeError(this.first_line,"オーバーフローしました");this.rtnv=new FloatValue(v,this.loc)}}code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"Add"!=c1&&"Sub"!=c1&&"Mul"!=c1&&"Div"!=c1&&"DivInt"!=c1&&"Mod"!=c1||(brace1=!0),"Minus"!=c2&&"Add"!=c2&&"Sub"!=c2&&"Mul"!=c2&&"Div"!=c2&&"DivInt"!=c2&&"Mod"!=c2||(brace2=!0),(brace1?"(":"")+v1.getCode()+(brace1?")":"")+"**"+(brace2?"(":"")+v2.getCode()+(brace2?")":"")}makePython(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"Add"!=c1&&"Sub"!=c1&&"Mul"!=c1&&"Div"!=c1&&"DivInt"!=c1&&"Mod"!=c1||(brace1=!0),"Minus"!=c2&&"Add"!=c2&&"Sub"!=c2&&"Mul"!=c2&&"Div"!=c2&&"DivInt"!=c2&&"Mod"!=c2||(brace2=!0),(brace1?"(":"")+v1.makePython()+(brace1?")":"")+" ** "+(brace2?"(":"")+v2.makePython()+(brace2?")":"")}getValue(){return this.rtnv}}class Add extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new Add(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列の足し算はできません");if(v1 instanceof BooleanValue||v2 instanceof BooleanValue)throw new RuntimeError(this.first_line,"真偽型の足し算はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)this.rtnv=new StringValue(v1.value+v2.value,this.loc);else{let v=v1.value+v2.value;if(v1 instanceof FloatValue||v2 instanceof FloatValue){if(!isFinite(v))throw new RuntimeError(this.first_line,"オーバーフローしました");this.rtnv=new FloatValue(v,this.loc)}else{if(!isSafeInteger(v))throw new RuntimeError(this.first_line,"整数で表される範囲を越えました");this.rtnv=new IntValue(v,this.loc)}}code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],c1,c2,brace1=!1,brace2=!1;return"Minus"==constructor_name(v1)&&(brace1=!0),"Minus"==constructor_name(v2)&&(brace2=!0),(brace1?"(":"")+v1.getCode()+(brace1?")":"")+"+"+(brace2?"(":"")+v2.getCode()+(brace2?")":"")}makePython(){let v1=this.value[0],v2=this.value[1],c1,c2,brace1=!1,brace2=!1;return"Minus"==constructor_name(v1)&&(brace1=!0),"Minus"==constructor_name(v2)&&(brace2=!0),(brace1?"(":"")+v1.makePython()+(brace1?")":"")+" + "+(brace2?"(":"")+v2.makePython()+(brace2?")":"")}getValue(){return this.rtnv}}class Sub extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new Sub(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列の引き算はできません");if(v1 instanceof BooleanValue||v2 instanceof BooleanValue)throw new RuntimeError(this.first_line,"真偽型の引き算はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列の引き算はできません");let v=v1.value-v2.value;if(v1 instanceof FloatValue||v2 instanceof FloatValue){if(!isFinite(v))throw new RuntimeError(this.first_line,"オーバーフローしました");this.rtnv=new FloatValue(v,this.loc)}else{if(!isSafeInteger(v))throw new RuntimeError(this.first_line,"整数で表される範囲を越えました");this.rtnv=new IntValue(v,this.loc)}code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],c1,c2,brace1=!1,brace2=!1;return"Minus"==constructor_name(v1)&&(brace1=!0),"Minus"==constructor_name(v2)&&(brace2=!0),(brace1?"(":"")+v1.getCode()+(brace1?")":"")+"-"+(brace2?"(":"")+v2.getCode()+(brace2?")":"")}makePython(){let v1=this.value[0],v2=this.value[1],c1,c2,brace1=!1,brace2=!1;return"Minus"==constructor_name(v1)&&(brace1=!0),"Minus"==constructor_name(v2)&&(brace2=!0),(brace1?"(":"")+v1.makePython()+(brace1?")":"")+" - "+(brace2?"(":"")+v2.makePython()+(brace2?")":"")}getValue(){return this.rtnv}}class Mul extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new Mul(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列のかけ算はできません");if(v1 instanceof BooleanValue||v2 instanceof BooleanValue)throw new RuntimeError(this.first_line,"真偽型のかけ算はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列のかけ算はできません");let v=v1.value*v2.value;if(v1 instanceof FloatValue||v2 instanceof FloatValue){if(!isFinite(v))throw new RuntimeError(this.first_line,"オーバーフローしました");this.rtnv=new FloatValue(v,this.loc)}else{if(!isSafeInteger(v))throw new RuntimeError(this.first_line,"整数で表される範囲を越えました");this.rtnv=new IntValue(v,this.loc)}code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"Add"!=c1&&"Sub"!=c1||(brace1=!0),"Minus"!=c2&&"Add"!=c2&&"Sub"!=c2||(brace2=!0),(brace1?"(":"")+v1.getCode()+(brace1?")":"")+"*"+(brace2?"(":"")+v2.getCode()+(brace2?")":"")}makePython(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"Add"!=c1&&"Sub"!=c1||(brace1=!0),"Minus"!=c2&&"Add"!=c2&&"Sub"!=c2||(brace2=!0),(brace1?"(":"")+v1.makePython()+(brace1?")":"")+" * "+(brace2?"(":"")+v2.makePython()+(brace2?")":"")}getValue(){return this.rtnv}}class Div extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new Div(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列のわり算はできません");if(v1 instanceof BooleanValue||v2 instanceof BooleanValue)throw new RuntimeError(this.first_line,"真偽型のわり算はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列のわり算はできません");if(0==v2.value)throw new RuntimeError(this.first_line,"0でわり算をしました");let v=v1.value/v2.value;if(!isFinite(v))throw new RuntimeError(this.first_line,"オーバーフローしました");this.rtnv=new FloatValue(v,this.loc),code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"Add"!=c1&&"Sub"!=c1||(brace1=!0),"Minus"!=c2&&"Add"!=c2&&"Sub"!=c2||(brace2=!0),(brace1?"(":"")+v1.getCode()+(brace1?")":"")+"/"+(brace2?"(":"")+v2.getCode()+(brace2?")":"")}makePython(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"Add"!=c1&&"Sub"!=c1||(brace1=!0),"Minus"!=c2&&"Add"!=c2&&"Sub"!=c2||(brace2=!0),(brace1?"(":"")+v1.makePython()+(brace1?")":"")+" / "+(brace2?"(":"")+v2.makePython()+(brace2?")":"")}getValue(){return this.rtnv}}class DivInt extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new DivInt(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列のわり算はできません");if(v1 instanceof BooleanValue||v2 instanceof BooleanValue)throw new RuntimeError(this.first_line,"真偽型のわり算はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列のわり算はできません");if(0==v2.value)throw new RuntimeError(this.first_line,"0でわり算をしました");let v=Math.floor(v1.value/v2.value);if(!isSafeInteger(v))throw new RuntimeError(this.first_line,"整数で表される範囲を越えました");this.rtnv=new IntValue(v,this.loc),code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"Add"!=c1&&"Sub"!=c1||(brace1=!0),"Minus"!=c2&&"Add"!=c2&&"Sub"!=c2||(brace2=!0),(brace1?"(":"")+v1.getCode()+(brace1?")":"")+"//"+(brace2?"(":"")+v2.getCode()+(brace2?")":"")}makePython(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"Add"!=c1&&"Sub"!=c1||(brace1=!0),"Minus"!=c2&&"Add"!=c2&&"Sub"!=c2||(brace2=!0),(brace1?"(":"")+v1.makePython()+(brace1?")":"")+" // "+(brace2?"(":"")+v2.makePython()+(brace2?")":"")}getValue(){return this.rtnv}}class Mod extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new Mod(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(!(v1 instanceof IntValue&&v2 instanceof IntValue))throw new RuntimeError(this.first_line,"余りを出す計算は整数でしかできません");{if(0==v2.value)throw new RuntimeError(this.first_line,"0でわり算をしました");let v=v1.value-Math.floor(v1.value/v2.value)*v2.value;if(!isSafeInteger(v))throw new RuntimeError(this.first_line,"整数で表される範囲を越えました");this.rtnv=new IntValue(v,this.loc),code[0].stack[0].index++}}getCode(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"Add"!=c1&&"Sub"!=c1||(brace1=!0),"Minus"!=c2&&"Add"!=c2&&"Sub"!=c2||(brace2=!0),(brace1?"(":"")+v1.getCode()+(brace1?")":"")+"%"+(brace2?"(":"")+v2.getCode()+(brace2?")":"")}makePython(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"Add"!=c1&&"Sub"!=c1||(brace1=!0),"Minus"!=c2&&"Add"!=c2&&"Sub"!=c2||(brace2=!0),(brace1?"(":"")+v1.makePython()+(brace1?")":"")+"%"+(brace2?"(":"")+v2.makePython()+(brace2?")":"")}getValue(){return this.rtnv}}class Minus extends Value{constructor(x,loc){super([x],loc)}clone(){var rtnv=new Minus(this.value[0],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue();if(!(v1 instanceof IntValue||v1 instanceof FloatValue))throw new RuntimeError(this.first_line,"マイナスは数値にしかつけられません");{let v=-v1.value;if(v1 instanceof IntValue&&!isSafeInteger(v))throw new RuntimeError(this.first_line,"整数で表される範囲を越えました");if(v1 instanceof FloatValue&&!isFinite(v))throw new RuntimeError(this.first_line,"オーバーフローしました");this.rtnv=v1 instanceof IntValue?new IntValue(v,this.loc):new FloatValue(v,this.loc)}code[0].stack[0].index++}getCode(){let v1=this.value[0],c1=constructor_name(v1),brace1=!1;return"Minus"!=c1&&"Add"!=c1&&"Sub"!=c1||(brace1=!0),"-"+(brace1?"(":"")+v1.getCode()+(brace1?")":"")}makePython(){let v1=this.value[0],c1=constructor_name(v1),brace1=!1;return"Minus"!=c1&&"Add"!=c1&&"Sub"!=c1||(brace1=!0),"-"+(brace1?"(":"")+v1.makePython()+(brace1?")":"")}getValue(){return this.rtnv}}class And extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new And(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue();if(!(v1 instanceof BooleanValue))throw new RuntimeError(this.first_line,"「かつ」は真偽値にしか使えません");if(v1.value){let v2=this.value[1].getValue();v2 instanceof BooleanValue&&(this.rtnv=new BooleanValue(v2.value,this.loc))}else this.rtnv=new BooleanValue(!1,this.loc);code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"And"!=c2&&"Or"!=c2&&"Not"!=c2||(brace2=!0),v1.getCode()+"かつ"+(brace2?"(":"")+v2.getCode()+(brace2?")":"")}makePython(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"And"!=c2&&"Or"!=c2&&"Not"!=c2||(brace2=!0),v1.makePython()+" and "+(brace2?"(":"")+v2.makePython()+(brace2?")":"")}getValue(){return this.rtnv}}class Or extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new Or(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue();if(!(v1 instanceof BooleanValue))throw new RuntimeError(this.first_line,"「または」は真偽値にしか使えません");if(v1.value)this.rtnv=new BooleanValue(!0,this.loc);else{let v2=this.value[1].getValue();v2 instanceof BooleanValue&&(this.rtnv=new BooleanValue(v2.value,this.loc))}code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"And"!=c2&&"Or"!=c2&&"Not"!=c2||(brace2=!0),v1.getCode()+"または"+(brace2?"(":"")+v2.getCode()+(brace2?")":"")}makePython(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"And"!=c2&&"Or"!=c2&&"Not"!=c2||(brace2=!0),v1.makePython()+" or "+(brace2?"(":"")+v2.makePython()+(brace2?")":"")}getValue(){return this.rtnv}}class Not extends Value{constructor(x,loc){super([x],loc)}clone(){var rtnv=new Not(this.value[0],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue();if(!(v1 instanceof BooleanValue))throw new RuntimeError(this.first_line,"「でない」は真偽値にしか使えません");this.rtnv=new BooleanValue(!v1.value,this.loc),code[0].stack[0].index++}getCode(){let v1=this.value[0],c1=constructor_name(v1),brace1=!1;return v1.getCode()+"でない"}makePython(){let v1=this.value[0],c1=constructor_name(v1),brace1=!1;return"And"!=c1&&"Or"!=c1&&"Not"!=c1||(brace2=!0),"not "+v1.getCode()}getValue(){return this.rtnv}}class BitAnd extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new BitAnd(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列のビット積はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列のビット積はできません");if(v1 instanceof BooleanValue&&v2 instanceof BooleanValue)this.rtnv=new BooleanValue(v1.value&v2.value,this.loc);else{if(v1 instanceof FloatValue||v2 instanceof FloatValue)throw new RuntimeError(this.first_line,"実数のビット積はできません");v1 instanceof BooleanValue&&(v1=new IntValue(v1.value?1:0,this.loc)),v2 instanceof BooleanValue&&(v2=new IntValue(v2.value?1:0,this.loc)),this.rtnv=new IntValue(v1.value&v2.value,this.loc)}code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"BitRShift"!=c1&&"BitLShift"!=c1||(brace1=!0),"Minus"!=c2&&"BitRShift"!=c2&&"BitLShift"!=c2||(brace2=!0),(brace1?"(":"")+v1.getCode()+(brace1?")":"")+"&"+(brace2?"(":"")+v2.getCode()+(brace2?")":"")}makePython(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"BitRShift"!=c1&&"BitLShift"!=c1&&"BitNot"!=c1||(brace1=!0),"Minus"!=c2&&"BitRShift"!=c2&&"BitLShift"!=c2&&"BitNot"!=c2||(brace2=!0),(brace1?"(":"")+v1.makePython()+(brace1?")":"")+" & "+(brace2?"(":"")+v2.makePython()+(brace2?")":"")}getValue(){return this.rtnv}}class BitOr extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new BitOr(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列のビット和はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列のビット和はできません");if(v1 instanceof BooleanValue&&v2 instanceof BooleanValue)this.rtnv=new BooleanValue(v1.value&v2.value,this.loc);else{if(v1 instanceof FloatValue||v2 instanceof FloatValue)throw new RuntimeError(this.first_line,"実数のビット和はできません");v1 instanceof BooleanValue&&(v1=new IntValue(v1.value?1:0,this.loc)),v2 instanceof BooleanValue&&(v2=new IntValue(v2.value?1:0,this.loc)),this.rtnv=new IntValue(v1.value|v2.value,this.loc)}code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"BitRShift"!=c1&&"BitLShift"!=c1&&"BitNot"!=c1||(brace1=!0),"Minus"!=c2&&"BitRShift"!=c2&&"BitLShift"!=c2&&"BitNot"!=c2||(brace2=!0),(brace1?"(":"")+v1.getCode()+(brace1?")":"")+"|"+(brace2?"(":"")+v2.getCode()+(brace2?")":"")}makePython(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"BitRShift"!=c1&&"BitLShift"!=c1&&"BitNot"!=c1||(brace1=!0),"Minus"!=c2&&"BitRShift"!=c2&&"BitLShift"!=c2&&"BitNot"!=c2||(brace2=!0),(brace1?"(":"")+v1.makePython()+(brace1?")":"")+" | "+(brace2?"(":"")+v2.makePython()+(brace2?")":"")}getValue(){return this.rtnv}}class BitXor extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new BitXor(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列の排他的ビット和はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列の排他的ビット和はできません");if(v1 instanceof BooleanValue&&v2 instanceof BooleanValue)this.rtnv=new BooleanValue(v1.value&v2.value,this.loc);else{if(v1 instanceof FloatValue||v2 instanceof FloatValue)throw new RuntimeError(this.first_line,"実数の排他的ビット和はできません");v1 instanceof BooleanValue&&(v1=new IntValue(v1.value?1:0,this.loc)),v2 instanceof BooleanValue&&(v2=new IntValue(v2.value?1:0,this.loc)),this.rtnv=new IntValue(v1.value^v2.value,this.loc)}code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"BitRShift"!=c1&&"BitLShift"!=c1&&"BitNot"!=c1||(brace1=!0),"Minus"!=c2&&"BitRShift"!=c2&&"BitLShift"!=c2&&"BitNot"!=c2||(brace2=!0),(brace1?"(":"")+v1.getCode()+(brace1?")":"")+"^"+(brace2?"(":"")+v2.getCode()+(brace2?")":"")}makePython(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"BitRShift"!=c1&&"BitLShift"!=c1&&"BitNot"!=c1||(brace1=!0),"Minus"!=c2&&"BitRShift"!=c2&&"BitLShift"!=c2&&"BitNot"!=c2||(brace2=!0),(brace1?"(":"")+v1.makePython()+(brace1?")":"")+" ^ "+(brace2?"(":"")+v2.makePython()+(brace2?")":"")}getValue(){return this.rtnv}}class BitNot extends Value{constructor(x,loc){super([x],loc)}clone(){var rtnv=new BitNot(this.value[0],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue();if(v1 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列のビット反転はできません");if(v1 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列のビット反転はできません");if(v1 instanceof BooleanValue)this.rtnv=new BooleanValue(!v1.value,this.loc);else{if(v1 instanceof FloatValue)throw new RuntimeError(this.first_line,"実数のビット反転はできません");this.rtnv=new IntValue(~v1.value,this.loc)}code[0].stack[0].index++}getCode(){let v1=this.value[0],c1=constructor_name(v1),brace1=!1;return"Minus"!=c1&&"BitRShift"!=c1&&"BitLShift"!=c1||(brace1=!0),"~"+(brace1?"(":"")+v1.getCode()+(brace1?")":"")}makePython(){let v1=this.value[0],c1=constructor_name(v1),brace1=!1;return"Minus"!=c1&&"BitRShift"!=c1&&"BitLShift"!=c1||(brace1=!0),"~"+(brace1?"(":"")+v1.getCode()+(brace1?")":"")}getValue(){return this.rtnv}}class BitLShift extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new BitLShift(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列のビットシフトはできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列のビットシフトはできません");if(v1 instanceof FloatValue||v2 instanceof FloatValue)throw new RuntimeError(this.first_line,"実数のビットシフトはできません");v1 instanceof BooleanValue&&(v1=new IntValue(v1.value?1:0,this.loc)),v2 instanceof BooleanValue&&(v2=new IntValue(v2.value?1:0,this.loc)),this.rtnv=new IntValue(v1.value<<v2.value,this.loc),code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"BitNot"!=c1||(brace1=!0),"Minus"!=c2&&"BitNot"!=c2||(brace2=!0),(brace1?"(":"")+v1.getCode()+(brace1?")":"")+"<<"+(brace2?"(":"")+v2.getCode()+(brace2?")":"")}makePython(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"BitNot"!=c1||(brace1=!0),"Minus"!=c2&&"BitNot"!=c2||(brace2=!0),(brace1?"(":"")+v1.makePython()+(brace1?")":"")+" << "+(brace2?"(":"")+v2.makePython()+(brace2?")":"")}getValue(){return this.rtnv}}class BitRShift extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new BitRShift(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列のビットシフトはできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列のビットシフトはできません");if(v1 instanceof FloatValue||v2 instanceof FloatValue)throw new RuntimeError(this.first_line,"実数のビットシフトはできません");v1 instanceof BooleanValue&&(v1=new IntValue(v1.value?1:0,this.loc)),v2 instanceof BooleanValue&&(v2=new IntValue(v2.value?1:0,this.loc)),this.rtnv=new IntValue(v1.value>>v2.value,this.loc),code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"BitNot"!=c1||(brace1=!0),"Minus"!=c2&&"BitNot"!=c2||(brace2=!0),(brace1?"(":"")+v1.getCode()+(brace1?")":"")+">>"+(brace2?"(":"")+v2.getCode()+(brace2?")":"")}makePython(){let v1=this.value[0],v2=this.value[1],c1=constructor_name(v1),c2=constructor_name(v2),brace1=!1,brace2=!1;return"Minus"!=c1&&"BitNot"!=c1||(brace1=!0),"Minus"!=c2&&"BitNot"!=c2||(brace2=!0),(brace1?"(":"")+v1.makePython()+(brace1?")":"")+" >> "+(brace2?"(":"")+v2.makePython()+(brace2?")":"")}getValue(){return this.rtnv}}function ArrayCompare(v1,v2){var rtnv=!0;if(v1 instanceof ArrayValue&&v2 instanceof ArrayValue){if(v1.length!=v2.length)return!1;for(let i=0;i<v1.length;i++)rtnv=rtnv&&ArrayCompare(v1.getValue().value[i],v2.getValue().value[i])}else rtnv=rtnv&&typeof v1==typeof v2&&v1.value==v2.value;return rtnv}class EQ extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new EQ(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.rtnv=new BooleanValue(ArrayCompare(v1,v2),this.loc);else{if(v1 instanceof StringValue!=v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列とそれ以外の値は比べられません");if(v1 instanceof BooleanValue!=v2 instanceof BooleanValue)throw new RuntimeError(this.first_line,"真偽値とそれ以外の値は比べられません");this.rtnv=new BooleanValue(v1.value==v2.value,this.loc)}code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],brace1=!1,brace2=!1;return v1.getCode()+"="+v2.getCode()}makePython(){let v1=this.value[0],v2=this.value[1],brace1=!1,brace2=!1;return v1.makePython()+" == "+v2.makePython()}getValue(){return this.rtnv}}class NE extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new NE(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)this.rtnv=new BooleanValue(!ArrayCompare(v1,v2),this.loc);else{if(v1 instanceof StringValue!=v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列とそれ以外の値は比べられません");if(v1 instanceof BooleanValue!=v2 instanceof BooleanValue)throw new RuntimeError(this.first_line,"真偽値とそれ以外の値は比べられません");this.rtnv=new BooleanValue(v1.value!=v2.value,this.loc)}code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],brace1=!1,brace2=!1;return v1.getCode()+"!="+v2.getCode()}makePython(){let v1=this.value[0],v2=this.value[1],brace1=!1,brace2=!1;return v1.makePython()+" != "+v2.makePython()}getValue(){return this.rtnv}}class GT extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new GT(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列を比べることはできません");if(v1 instanceof StringValue!=v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列とそれ以外の値は比べられません");if(v1 instanceof BooleanValue!=v2 instanceof BooleanValue)throw new RuntimeError(this.first_line,"真偽値とそれ以外の値は比べられません");this.rtnv=new BooleanValue(v1.value>v2.value,this.loc),code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],brace1=!1,brace2=!1;return v1.getCode()+">"+v2.getCode()}makePython(){let v1=this.value[0],v2=this.value[1],brace1=!1,brace2=!1;return v1.makePython()+" > "+v2.makePython()}getValue(){return this.rtnv}}class GE extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new GE(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列を比べることはできません");if(v1 instanceof StringValue!=v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列とそれ以外の値は比べられません");if(v1 instanceof BooleanValue!=v2 instanceof BooleanValue)throw new RuntimeError(this.first_line,"真偽値とそれ以外の値は比べられません");this.rtnv=new BooleanValue(v1.value>=v2.value,this.loc),code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],brace1=!1,brace2=!1;return v1.getCode()+">="+v2.getCode()}makePython(){let v1=this.value[0],v2=this.value[1],brace1=!1,brace2=!1;return v1.makePython()+" >= "+v2.makePython()}getValue(){return this.rtnv}}class LT extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new LT(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列を比べることはできません");if(v1 instanceof StringValue!=v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列とそれ以外の値は比べられません");if(v1 instanceof BooleanValue!=v2 instanceof BooleanValue)throw new RuntimeError(this.first_line,"真偽値とそれ以外の値は比べられません");this.rtnv=new BooleanValue(v1.value<v2.value,this.loc),code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],brace1=!1,brace2=!1;return v1.getCode()+"<"+v2.getCode()}makePython(){let v1=this.value[0],v2=this.value[1],brace1=!1,brace2=!1;return v1.makePython()+" < "+v2.makePython()}getValue(){return this.rtnv}}class LE extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new LE(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列を比べることはできません");if(v1 instanceof StringValue!=v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列とそれ以外の値は比べられません");if(v1 instanceof BooleanValue!=v2 instanceof BooleanValue)throw new RuntimeError(this.first_line,"真偽値とそれ以外の値は比べられません");this.rtnv=new BooleanValue(v1.value<=v2.value,this.loc),code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],brace1=!1,brace2=!1;return v1.getCode()+"<="+v2.getCode()}makePython(){let v1=this.value[0],v2=this.value[1],brace1=!1,brace2=!1;return v1.makePython()+" <= "+v2.makePython()}getValue(){return this.rtnv}}class IN extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new IN(this.value[0],this.value[1],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1=this.value[0].getValue(),v2=this.value[1].getValue();var flag=!1;if(!(v1 instanceof ArrayValue))throw new RuntimeError(this.first_line,'"の中に"の前には配列が必要です');for(i=0;i<v1.value.length;i++)flag|=ArrayCompare(v1.value[i],v2);this.rtnv=new BooleanValue(flag,this.loc),code[0].stack[0].index++}getCode(){let v1=this.value[0],v2=this.value[1],brace1=!1,brace2=!1;return v1.getCode()+"の中に"+v2.getCode()}makePython(){let v1=this.value[0],v2,brace1=!1,brace2=!1;return this.value[1].makePython()+" in "+v1.makePython()}getValue(){return this.rtnv}}class ConvertInt extends Value{constructor(x,loc){super([x],loc)}clone(){var rtnv=new ConvertInt(this.value[0],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v=this.value[0].getValue(),r=Number.NaN;if(v instanceof IntValue?r=v.value:v instanceof FloatValue?r=Math.floor(v.value):v instanceof StringValue?r=Math.floor(Number(v.value)):v instanceof BooleanValue&&(r=v.value?1:0),!isSafeInteger(r))throw new RuntimeError(this.loc.first_line,"整数に直せません");this.rtnv=new IntValue(r,this.loc),code[0].stack[0].index++}getCode(){return"整数("+this.value[0].getCode()+")"}makePython(){return"int("+this.value[0].makePython()+")"}getValue(){return this.rtnv}}class ConvertFloat extends Value{constructor(x,loc){super([x],loc)}clone(){var rtnv=new ConvertFloat(this.value[0],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v=this.value[0].getValue(),r=Number.NaN;if(v instanceof IntValue||v instanceof FloatValue?r=v.value:v instanceof StringValue?r=Number(v.value):v instanceof BooleanValue&&(r=v.value?1:0),!isFinite(r))throw new RuntimeError(this.loc.first_line,"実数に直せません");this.rtnv=new FloatValue(r,this.loc),code[0].stack[0].index++}getCode(){return"実数("+this.value[0].getCode()+")"}makePython(){return"float("+this.value[0].makePython()+")"}getValue(){return this.rtnv}}class ConvertString extends Value{constructor(x,loc){super([x],loc)}clone(){var rtnv=new ConvertString(this.value[0],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v=this.value[0].getValue(),r="";v instanceof IntValue||v instanceof FloatValue?r=String(v.value):v instanceof StringValue?r=v.value:v instanceof BooleanValue&&(r=v.value?"True":"False"),this.rtnv=new StringValue(r,this.loc),code[0].stack[0].index++}getCode(){return"文字列("+this.value[0].getCode()+")"}makePython(){return"str("+this.value[0].makePython()+")"}getValue(){return this.rtnv}}class ConvertBool extends Value{constructor(x,loc){super([x],loc)}clone(){var rtnv=new ConvertBool(this.value[0],this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v=this.value[0].getValue(),r="",re=/^(0+|false|偽|)$/i;v instanceof IntValue||v instanceof FloatValue?r=0!=v.value:v instanceof StringValue?r=!re.exec(v.value):v instanceof BooleanValue&&(r=v.value),this.rtnv=new BooleanValue(r,this.loc),code[0].stack[0].index++}getCode(){return"真偽("+this.value[0].getCode()+")"}makePython(){return"bool("+this.value[0].makePython()+")"}getValue(){return this.rtnv}}class Variable extends Value{constructor(x,y,loc){super([x,y],loc),this.rtnv=null}clone(){var rtnv=new Variable(this.value[0],this.value[1]?this.value[1]:null,this.loc);return rtnv.rtnv=this.rtnv,rtnv}get varname(){return this.value[0]}get args(){return this.value[1]}run(){let vn=this.value[0],vt=findVarTable(vn);if(!vt)throw new RuntimeError(this.first_line,"変数"+this.value[0]+"が定義されていません");{let v=vt.vars[vn];this.rtnv=getValueByArgs(v,this.args,this.loc)}code[0].stack[0].index++}getCode(){let vn=this.value[0],pm=this.value[1];if(null!=pm){let ag=new Array(pm.length);for(let i=0;i<pm.length;i++)ag[i]=pm.value[i].getCode();vn+="["+ag.join(",")+"]"}return vn}makePython(){let vn=this.value[0],pm=this.value[1];if(null!=pm){let ag=new Array(pm.length);for(let i=0;i<pm.length;i++)ag[i]="["+pm.value[i].makePython()+"]";vn+=ag.join("")}return vn}getValue(){return this.rtnv}append(a){this.args?this.args.append(a):this.value[1]=new ArrayValue(a,this.loc)}}class DefinedFunction{constructor(argc,func,module,convert){this.argc=argc,this.func=func,this.module=module,this.convert=convert,this.caller=null,this.loc=null}run(){if(!(this.argc instanceof Array&&this.argc[0]<=this.parameters.length&&this.argc[1]>=this.parameters.length||this.parameters.length==this.argc))throw new RuntimeError(this.loc.first_line,"引数の個数が違います");code[0].stack[0].index++,this.caller.setValue(this.func(this.parameters,this.loc)),code.shift()}clone(){return new DefinedFunction(this.argc,this.func,this.module,this.convert)}setCaller(caller){this.caller=caller}setParameter(params){this.parameters=params}setLocation(loc){this.loc=loc}}var definedFunction={keys:new DefinedFunction(1,(function(param,loc){var par1=param[0].getValue();if(par1 instanceof DictionaryValue){var args=[],keys=Object.keys(par1.value);keys.sort();for(let i=0;i<keys.length;i++)args.push(new StringValue(keys[i],loc));return new ArrayValue(args,this.loc)}throw new RuntimeError(loc.first_line,"keysは辞書にしか使えません")}),null,null),abs:new DefinedFunction(1,(function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue)return new IntValue(Math.abs(par1.value),loc);if(par1 instanceof FloatValue)return new FloatValue(Math.abs(par1.value),loc);throw new RuntimeError(loc.first_line,"absは数値にしか使えません")}),null,null),random:new DefinedFunction([0,1],(function(param,loc){if(0==param.length)return new FloatValue(Math.random(),this.loc);var par1=param[0].getValue();if(par1 instanceof IntValue)return new IntValue(Math.floor(Math.random()*Math.floor(par1.value+1)),this.loc);throw new RuntimeError(loc.first_line,"randomは整数にしか使えません")}),"random",(function(argc){return"random.randint(0,"+argc[0]+")"})),ceil:new DefinedFunction(1,(function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue)return par1;if(par1 instanceof FloatValue)return new IntValue(Math.ceil(par1.value),this.loc);throw new RuntimeError(loc.first_line,"ceilは数値にしか使えません")}),"math",null),floor:new DefinedFunction(1,(function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue)return par1;if(par1 instanceof FloatValue)return new IntValue(Math.floor(par1.value),this.loc);throw new RuntimeError(loc.first_line,"floorは数値にしか使えません")}),"math",null),round:new DefinedFunction(1,(function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue)return par1;if(par1 instanceof FloatValue)return new IntValue(Math.round(par1.value),this.loc);throw new RuntimeError(loc.first_line,"roundは数値にしか使えません")}),null,null),sin:new DefinedFunction(1,(function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue)return new FloatValue(Math.sin(par1.value),this.loc);throw new RuntimeError(loc.first_line,"sinは数値にしか使えません")}),"math",null),cos:new DefinedFunction(1,(function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue)return new FloatValue(Math.cos(par1.value),this.loc);throw new RuntimeError(loc.first_line,"cosは数値にしか使えません")}),"math",null),tan:new DefinedFunction(1,(function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue){let v=Math.tan(par1.value);if(isFinite(v))return new FloatValue(v,this.loc);throw new RuntimeError(loc.first_line,"オーバーフローしました")}throw new RuntimeError(loc.first_line,"tanは数値にしか使えません")}),"math",null),asin:new DefinedFunction(1,(function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue){if(par1.value>1||par1.value<-1)throw new RuntimeError(loc.first_line,"asinの定義域外の値が使われました");return new FloatValue(Math.asin(par1.value),this.loc)}throw new RuntimeError(loc.first_line,"asinは数値にしか使えません")}),"math",null),acos:new DefinedFunction(1,(function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue){if(par1.value>1||par1.value<-1)throw new RuntimeError(loc.first_line,"acosの定義域外の値が使われました");return new FloatValue(Math.acos(par1.value),this.loc)}throw new RuntimeError(loc.first_line,"acosは数値にしか使えません")}),"math",null),atan:new DefinedFunction(1,(function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue)return new FloatValue(Math.atan(par1.value),this.loc);throw new RuntimeError(loc.first_line,"atanは数値にしか使えません")}),"math",null),atan2:new DefinedFunction(2,(function(param,loc){var par1=param[0].getValue(),par2=param[1].getValue();if((par1 instanceof IntValue||par1 instanceof FloatValue)&&(par2 instanceof IntValue||par2 instanceof FloatValue))return new FloatValue(Math.atan2(par1.value,par2.value),this.loc);throw new RuntimeError(loc.first_line,"atan2は数値にしか使えません")}),"math",null),sqrt:new DefinedFunction(1,(function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue){if(par1.value<0)throw new RuntimeError(loc.first_line,"負の数のルートを求めようとしました");return new FloatValue(Math.sqrt(par1.value),this.loc)}throw new RuntimeError(this.first_line,"sqrtは数値にしか使えません")}),"math",null),log:new DefinedFunction(1,(function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue){if(par1.value<=0)throw new RuntimeError(loc.first_line,"正でない数の対数を求めようとしました");let v=Math.log(par1.value);if(isFinite(v))return new FloatValue(v,this.loc);throw new RuntimeError(this.first_line,"オーバーフローしました")}throw new RuntimeError(loc.first_line,"logは数値にしか使えません")}),"math",null),exp:new DefinedFunction(1,(function(param,loc){var par1=param[0].getValue();if(par1 instanceof IntValue||par1 instanceof FloatValue){let v=Math.exp(par1.value);if(isFinite(v))return new FloatValue(v,this.loc);throw new RuntimeError(loc.first_line,"オーバーフローしました")}throw new RuntimeError(loc.first_line,"expは数値にしか使えません")}),"math",null),pow:new DefinedFunction(2,(function(param,loc){var par1=param[0].getValue(),par2=param[1].getValue();if(par1 instanceof IntValue&&par2 instanceof IntValue&&par2.value>=0){if(0==par1.value&&par2.value<=0)throw new RuntimeError(loc.first_line,"0は正の数乗しかできません");let v=Math.pow(par1.value,par2.value);if(isSafeInteger(v))return new IntValue(v,this.loc);throw new RuntimeError(loc.first_line,"整数で表せる範囲を越えました")}if((par1 instanceof IntValue||par1 instanceof FloatValue)&&(par2 instanceof IntValue||par2 instanceof FloatValue)){if(par1.value<0&&!Number.isInteger(par2.value))throw new RuntimeError(loc.first_line,"負の数の非整数乗はできません");if(0==par1.value&&par2.value<=0)throw new RuntimeError(loc.first_line,"0は正の数乗しかできません");let v=Math.pow(par1.value,par2.value);if(isFinite(v))return new FloatValue(v,this.loc);throw new RuntimeError(loc.first_line,"オーバーフローしました")}throw new RuntimeError(loc.first_line,"powerは数値にしか使えません")}),null,null),length:new DefinedFunction(1,(function(param,loc){var par1=param[0].getValue();if(par1 instanceof StringValue)return new IntValue(par1.value.length,this.loc);if(par1 instanceof ArrayValue)return new IntValue(par1.length,this.loc);throw new RuntimeError(loc.first_line,"lengthは文字列と配列にしか使えません")}),null,(function(argc){return"len("+argc[0]+")"})),substring:new DefinedFunction([2,3],(function(param,loc){var par1=param[0].getValue(),par2=param[1].getValue(),par3=3==param.length?param[2].getValue():null,v;if(par1 instanceof StringValue&&par2 instanceof IntValue&&(null==par3||par3 instanceof IntValue))return v=null==par3?par1.value.substr(par2.value):par1.value.substr(par2.value,par3.value),new StringValue(v,this.loc);throw new RuntimeError(loc.first_line,"substringの引数の型が違います")}),null,(function(argc){var code=argc[0]+"["+argc[1]+":";return argc[2]&&(code+=argc[1]+"+"+argc[2]),code+"]"})),append:new DefinedFunction(2,(function(param,loc){var par1=param[0].getValue(),par2=param[1].getValue();if(par2 instanceof StringValue&&par2 instanceof StringValue)return new StringValue(par1.value+par2.value,this.loc);throw new RuntimeError(loc.first_line,"appendの引数の型が違います")}),null,(function(argc){return argc[0]+"+"+argc[1]})),split:new DefinedFunction(2,(function(param,loc){var par1=param[0].getValue(),par2=param[1].getValue();if(par1 instanceof StringValue&&par2 instanceof StringValue){for(var v1=par1.value,v2=par2.value,v=v1.split(v2),vr=[],i=0;i<v.length;i++)vr.push(new StringValue(v[i],this.loc));return new ArrayValue(vr,this.loc)}throw new RuntimeError(loc.first_line,"splitの引数の型が違います")}),null,(function(argc){return argc[0]+".split("+argc[1]+")"})),extract:new DefinedFunction(3,(function(param,loc){var par1=param[0].getValue(),par2=param[1].getValue(),par3=param[2].getValue();if(par1 instanceof StringValue&&par2 instanceof StringValue&&par3 instanceof IntValue){var v1=par1.value,v2=par2.value,v3=par3.value,v=v1.split(v2);if(v3>=0&&v3<v.length)return new StringValue(v[v3],this.loc);throw new RuntimeError(loc.first_line,"番号の値が不正です")}throw new RuntimeError(loc.first_line,"extractの引数の型が違います")}),null,(function(argc){return argc[0]+".split("+argc[1]+")["+argc[2]+"]"})),insert:new DefinedFunction(3,(function(param,loc){var par1=param[0].getValue(),par2=param[1].getValue(),par3=param[2].getValue();if(par1 instanceof StringValue&&par2 instanceof IntValue&&par3 instanceof StringValue){var v1=par1.value,v2=par2.value,v3=par3.value;if(v2<0||v2>v1.length)throw new RuntimeError(loc.first_line,"位置の値が不正です");var s1=v1.substr(0,v2),s2=v1.substr(v2);return new StringValue(s1+v3+s2,this.loc)}throw new RuntimeError(loc.first_line,"insertの引数の型が違います")}),null,(function(argc){return argc[0]+"[:"+argc[1]+"]+"+argc[2]+"+"+argc[0]+"["+argc[1]+":]"})),replace:new DefinedFunction(4,(function(param,loc){var par1=param[0].getValue(),par2=param[1].getValue(),par3=param[2].getValue(),par4=param[3].getValue();if(par1 instanceof StringValue&&par2 instanceof IntValue&&par3 instanceof IntValue&&par4 instanceof StringValue){var v1=par1.value,v2=par2.value,v3=par3.value,v4=par4.value;if(v2<0||v2>v1.length)throw new RuntimeError(loc.first_line,"位置の値が不正です");if(v3<0||v2+v3>v1.length)throw new RuntimeError(loc.first_line,"長さの値が不正です");var s1=v1.substr(0,v2),s2=v1.substr(v2+v3);return new StringValue(s1+v4+s2,this.loc)}throw new RuntimeError(loc.first_line,"replaceの引数の型が違います")}),null,(function(argc){return argc[0]+"[:"+argc[1]+"]+"+argc[3]+"+"+argc[0]+"["+argc[1]+"+"+argc[2]+":]"}))};function setCaller(statementlist,caller){for(let i=0;i<statementlist.length;i++)statementlist[i].statementlist&&setCaller(statementlist[i].statementlist,caller),statementlist[i].state&&setCaller(statementlist[i].state,caller),statementlist[i].state1&&setCaller(statementlist[i].state1,caller),statementlist[i].state2&&setCaller(statementlist[i].state2,caller),statementlist[i]instanceof ReturnStatement&&statementlist[i].setCaller(caller,!0)}function cloneStatementlist(statementlist){var rtnv=[];for(let i=0;i<statementlist.length;i++){let statement=statementlist[i];rtnv.push(statement.clone())}return rtnv}class CallFunction extends Value{constructor(funcname,parameter,loc){super({funcname:funcname,parameter:parameter},loc),this.rtnv=null}clone(){var rtnv;return this.rtnv.clone()}run(){const func=this.value.funcname,param=this.value.parameter;if(definedFunction[func]){let index=code[0].stack[0].index,fn=definedFunction[func].clone();fn.setCaller(this),fn.setParameter(param),fn.setLocation(this.loc);let statementlist=[new runBeforeGetValue(param),fn];code.unshift(new parsedFunction(statementlist)),code[1].stack[0].index=index+1}else{if(!myFuncs[func])throw new RuntimeError(this.first_line,"関数 "+func+" は定義されていません");{code[0].stack[0].index++;let fn=myFuncs[func],vt=new varTable,globalVarTable=varTables[varTables.length-1];for(let i of Object.keys(globalVarTable.vars))vt.vars[i]=globalVarTable.vars[i].getValue().clone();for(let i=0;i<fn.params.length;i++)vt.vars[fn.params[i].varname]=param[i].getValue().clone();let statementlist=cloneStatementlist(fn.statementlist);statementlist.unshift(new runBeforeGetValue(fn.param)),setCaller(statementlist,this),statementlist.push(new notReturnedFunction(fn.loc));let pf=new parsedFunction(statementlist);code.unshift(pf),varTables.unshift(vt)}}}setValue(v){this.rtnv=v.clone()}getValue(){return this.rtnv}getCode(){let func=this.value.funcname,param=this.value.parameter,ag=[];for(let i=0;i<param.length;i++)ag.push(param[i].getCode());return func+"("+ag.join(",")+")"}makePython(){let func=this.value.funcname,param=this.value.parameter,deffunc=null;definedFunction[func]?deffunc=definedFunction[func]:myFuncs[func]&&(deffunc=myFuncs[func]);let ag=[];for(let i=0;i<param.length;i++)ag.push(param[i].makePython());if(deffunc){var prefix="";return deffunc.module&&(prefix=deffunc.module+".",python_lib[deffunc.module]=1),deffunc.convert?deffunc.convert(ag):prefix+func+"("+ag.join(",")+")"}return func+"("+ag.join(",")+")"}}class Connect extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new Connect(this.value[0].clone(),this.value[1].clone(),this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){let v1,v2;v1=array2text(this.value[0].getValue()),v2=array2text(this.value[1].getValue());let v=v1+v2;this.rtnv=new StringValue(v,this.loc),code[0].stack[0].index++}getCode(){return this.value[0].getCode()+"と"+this.value[1].getCode()}makePython(){var re=/^str\(/,p1=this.value[0].makePython(),p2=this.value[1].makePython();return re.exec(p1)||this.value[0]instanceof StringValue||(p1="str("+p1+")"),re.exec(p2)||this.value[1]instanceof StringValue||(p2="str("+p2+")"),p1+"+"+p2}getValue(){return this.rtnv}}class SliceValue extends Value{constructor(x,y,loc){super([x,y],loc)}clone(){var rtnv=new SliceValue(this.value[0].clone(),this.value[1].clone(),this.loc);return rtnv.rtnv=this.rtnv,rtnv}run(){var idx=code[0].stack[0].index;this.value[0].run(),this.value[1].run(),code[0].stack[0].index=idx+1}getCode(){return this.value[0].getCode()+":"+this.value[1].getCode()}makePython(){var p1,p2;return this.value[0].makePython()+":"+this.value[1].makePython()}getValue(){return this}getValue1(){return this.value[0]}getValue2(){return this.value[1]}}class Statement{constructor(loc){this._loc=loc}get first_line(){return this._loc.first_line}get last_line(){return this._loc.last_line}get loc(){return this._loc}run(){code[0].stack[0].index++}makePython(indent){return Parts.makeIndent(indent)}clone(){throw new RuntimeError(this.first_line,constructor_name(this)+"はcloneが作られていません")}}class DefineStep extends Statement{constructor(funcName,params,statementlist,loc){if(super(loc),definedFunction[funcName])throw new RuntimeError(this.first_line,"手続き "+funcName+" と同名の標準関数が存在します");if(myFuncs[funcName])throw new RuntimeError(this.first_line,"手続き "+funcName+" と同名の関数、または手続きが既に定義されています");this.params=params,this.statementlist=statementlist,this.funcName=funcName,myFuncs[funcName]=this}makePython(indent){for(var code="def "+this.funcName+"(",i=0;i<this.params.length;i++)i>0&&(code+=","),code+=this.params[i].varname;code+="):\n";for(var codes=0,i=0;i<this.statementlist.length;i++)this.statementlist[i]&&(codes=1,code+=this.statementlist[i].makePython(1));return 0==codes&&(code+=Parts.makeIndent(1)+"None\n"),code}}class afterCallStep{run(){varTables.shift(),code.shift()}}class CallStep extends Statement{constructor(funcName,args,loc){super(loc),this.funcName=funcName,this.args=args}clone(){return new CallStep(this.funcName,this.args.clone(),this.loc)}run(){code[0].stack[0].index++;const fn=this.funcName,args=this.args;if(!myFuncs[fn])throw new RuntimeError(this.first_line,"手続き "+fn+" は定義されていません");{let vt=new varTable,globalVarTable=varTables[varTables.length-1];for(let i of Object.keys(globalVarTable.vars))vt.vars[i]=globalVarTable.vars[i].getValue().clone();for(let i=0;i<myFuncs[fn].params.length;i++)vt.vars[myFuncs[fn].params[i].varname]=args[i].getValue().clone();let statementlist=myFuncs[fn].statementlist.concat();statementlist.push(new afterCallStep),code.unshift(new parsedStep(statementlist)),varTables.unshift(vt)}}makePython(indent){var code=Parts.makeIndent(indent);code+=this.funcName+"(";for(var i=0;i<this.args.length;i++)i>0&&(code+=","),code+=this.args[i].varname;return code+")\n"}}class ExitStatement extends Statement{constructor(loc){super(loc)}clone(){return new ExitStatement(this.loc)}run(){if(!(code[0]instanceof parsedStep))throw new RuntimeError(this.first_line,"手続きの中ではありません");code.shift(),varTables.shift()}makePython(indent){var code=Parts.makeIndent(indent);return code+="break\n"}}class DefineFunction extends Statement{constructor(funcName,params,statementlist,loc){if(super(loc),definedFunction[funcName])throw new RuntimeError(this.first_line,"関数 "+funcName+" と同名の標準関数が存在します");if(myFuncs[funcName])throw new RuntimeError(this.first_line,"関数 "+funcName+" と同名の関数、または手続きが既に定義されています");this.params=params,this.funcName=funcName,myFuncs[funcName]=this,this.statementlist=statementlist}run(){super.run()}makePython(indent){var code="def ";code+=this.funcName+"(";for(var i=0;i<this.params.length;i++)i>0&&(code+=","),code+=this.params[i].makePython();code+="):\n";for(var codes=0,i=0;i<this.statementlist.length;i++)this.statementlist[i]&&(codes=1,code+=this.statementlist[i].makePython(1));return 0==codes&&(code+=Parts.makeIndent(1)+"None\n"),code}}class ReturnStatement extends Statement{constructor(value,loc){super(loc),this.value=value,this.caller=null,this.flag=!1}clone(){return new ReturnStatement(this.value,this.loc)}setCaller(caller,flag){this.caller=caller,this.flag=flag}run(){if(!(code[0]instanceof parsedFunction))throw new RuntimeError(this.first_line,"関数の中ではありません");this.caller.setValue(this.value.getValue()),code.shift(),this.flag&&varTables.shift()}makePython(indent){var code=Parts.makeIndent(indent);return code+="return",this.value&&(code+=" "+this.value.makePython()),code+"\n"}}class notReturnedFunction extends Statement{constructor(loc){super(loc)}clone(){return new notReturnedFunction(this.loc)}run(){throw new RuntimeError(this.last_line,"関数が値を返さずに終了しました")}makePython(){return""}}function dump(){textareaAppend("*** 変数確認 ***\n");var vars=varTables[0].varnames([]);varTables.length>1&&(vars=varTables[varTables.length-1].varnames(vars));for(var i=0;i<vars.length;i++){let vartable,v=findVarTable(vars[i]).vars[vars[i]];textareaAppend(vars[i]+":"+array2code(v)+"\n")}}class DumpStatement extends Statement{constructor(loc){super(loc)}clone(){return new DumpStatement(this.loc)}run(){dump(),super.run()}makePython(){return""}}function valuelist2stack(args,queue){if(args instanceof Array)for(let i=0;i<args.length;i++){let v=args[i];v instanceof ArrayValue?valuelist2stack(v.value,queue):v instanceof DictionaryValue?valuelist2stack(v.value,queue):v instanceof Variable&&v.args?valuelist2stack(v.args,queue):v&&!(v instanceof Variable)&&v.value instanceof Array?valuelist2stack(v.value,queue):v instanceof CallFunction&&valuelist2stack(v.value.parameter,queue),queue.push(v)}else if(args instanceof ArrayValue)for(let i=0;i<args.length;i++){let v=args.value[i];v instanceof ArrayValue?valuelist2stack(v.value,queue):v instanceof DictionaryValue?valuelist2stack(v.value,queue):v instanceof Variable&&v.args?valuelist2stack(v.args,queue):v&&!(v instanceof Variable)&&v.value instanceof Array?valuelist2stack(v.value,queue):v instanceof CallFunction&&valuelist2stack(v.value.parameter,queue),queue.push(v)}else if(args instanceof DictionaryValue)for(var key in args.getValue().value){let v=args.getValue().value[key];v instanceof ArrayValue?valuelist2stack(v.value,queue):v instanceof DictionaryValue?valuelist2stack(v.value,queue):v instanceof Variable&&v.args?valuelist2stack(v.args,queue):v&&!(v instanceof Variable)&&v.value instanceof Array?valuelist2stack(v.value,queue):v instanceof CallFunction&&valuelist2stack(v.value.parameter,queue),queue.push(v)}else for(var key in args){let v=args[key];v&&(v instanceof ArrayValue?valuelist2stack(v.value,queue):v instanceof DictionaryValue?valuelist2stack(v.value,queue):v instanceof Variable&&v.args?valuelist2stack(v.args,queue):v&&!(v instanceof Variable)&&v.value instanceof Array?valuelist2stack(v.value,queue):v instanceof CallFunction&&valuelist2stack(v.value.parameter,queue),v&&queue.push(v))}}class runBeforeGetValue extends Statement{constructor(args,loc){super(loc),this.args=args}clone(){return new runBeforeGetValue(this.args,this.loc)}run(){super.run();let queue=[];valuelist2stack(this.args,queue),code[0].stack.unshift({statementlist:queue,index:0})}makePython(){return""}}class runArgsBeforeGetValue extends Statement{constructor(args,loc){super(loc),this.args=args}clone(){for(var args=[],i=0;i<this.args.length;i++)args.push(this.args[i].clone());return new runArgsBeforeGetValue(this.args,this.loc)}run(){super.run();let queue=[];for(let i=0;i<this.args.length;i++)this.args[i]instanceof SliceValue?(valuelist2stack(this.args[i].getValue1(),queue),valuelist2stack(this.args[i].getValue2(),queue)):(this.args[i].parameter&&valuelist2stack(this.args[i].parameter,queue),this.args[i].args&&valuelist2stack(this.args[i].args,queue));code[0].stack.unshift({statementlist:queue,index:0})}makePython(){return""}}function argsString(args){if(args instanceof ArrayValue){let a=[];for(let i=0;i<args.value.length;i++)a.push(args.value[i].getValue().value);return"["+a.join(",")+"]"}return""}class Assign extends Statement{constructor(variable,value,operator,loc){if(super(loc),!(variable instanceof Variable||variable instanceof UNDEFINED))throw new RuntimeError(loc.first_line,"変数でないものに代入はできません");this.variable=variable,this.value=value,this.operator=operator}clone(){return new Assign(this.variable,this.value,this.operator,this.loc)}run(){if(this.variable instanceof UNDEFINED)throw new RuntimeError(this.first_line,"未完成のプログラムです");let index=code[0].stack[0].index,vn=this.variable.varname,ag=this.variable.args,vl=this.value.getValue(),vt=findVarTable(vn);if(vt){let va=vt.vars[vn];if(this.operator){va=getValueByArgs(va,ag,this.loc);let v1=va.getValue(),v2=vl,v3=null;switch(this.operator){case"+":if(v1 instanceof BooleanValue&&(v1=new IntValue(v1.value?1:0,this.loc)),v2 instanceof BooleanValue&&(v2=new IntValue(v2.value?1:0,this.loc)),v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列の足し算はまだサポートしていません");if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)throw new RuntimeError(this.first_line,"辞書の足し算はまだサポートしていません");v1 instanceof StringValue||v2 instanceof StringValue?v3=new StringValue(String(v1.value)+String(v2.value),this.loc):v1 instanceof IntValue&&v2 instanceof IntValue?v3=new IntValue(v1.value+v2.value,this.loc):(v1 instanceof FloatValue||v2 instanceof FloatValue)&&(v3=new FloatValue(v1.value+v2.value,this.loc));break;case"-":if(v1 instanceof BooleanValue&&(v1=new IntValue(v1.value?1:0,this.loc)),v2 instanceof BooleanValue&&(v2=new IntValue(v2.value?1:0,this.loc)),v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列の引き算はできません");if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)throw new RuntimeError(this.first_line,"辞書の引き算はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列の引き算はできません");v1 instanceof IntValue&&v2 instanceof IntValue?v3=new IntValue(v1.value-v2.value,this.loc):(v1 instanceof FloatValue||v2 instanceof FloatValue)&&(v3=new FloatValue(v1.value-v2.value,this.loc));break;case"*":if(v1 instanceof BooleanValue&&(v1=new IntValue(v1.value?1:0,this.loc)),v2 instanceof BooleanValue&&(v2=new IntValue(v2.value?1:0,this.loc)),v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列の掛け算は出来ません");if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)throw new RuntimeError(this.first_line,"辞書の掛け算はできません");if(v1 instanceof StringValue){if(!(v2 instanceof IntValue))throw new RuntimeError(this.first_line,"文字列に掛けられるのは整数だけです");v3=new StringValue(v1.value.repeat(v2.value>=0?v2.value:0),this.loc)}else v1 instanceof IntValue&&v2 instanceof IntValue?v3=new IntValue(v1.value*v2.value,this.loc):(v1 instanceof FloatValue||v2 instanceof FloatValue)&&(v3=new FloatValue(v1.value*v2.value,this.loc));break;case"/":if(v1 instanceof BooleanValue&&(v1=new IntValue(v1.value?1:0,this.loc)),v2 instanceof BooleanValue&&(v2=new IntValue(v2.value?1:0,this.loc)),v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列の割り算はできません");if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)throw new RuntimeError(this.first_line,"辞書の割り算はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列の割り算はできません");if(0==v2.value)throw new RuntimeError(this.first_line,"0で割り算をしました");v3=new FloatValue(v1.value/v2.value,this.loc);break;case"//":case"%":if(v1 instanceof BooleanValue&&(v1=new IntValue(v1.value?1:0,this.loc)),v2 instanceof BooleanValue&&(v2=new IntValue(v2.value?1:0,this.loc)),v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列の割り算はできません");if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)throw new RuntimeError(this.first_line,"辞書の割り算はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列の割り算はできません");{if(0==v2.value)throw new RuntimeError(this.first_line,"0で割り算をしました");let v4=v1.value-Math.floor(v1.value/v2.value)*v2.value;v3=v1 instanceof IntValue&&v2 instanceof IntValue?new IntValue(v4,this.loc):new FloatValue(v4,this.loc)}break;case"&":if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列のビット積はできません");if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)throw new RuntimeError(this.first_line,"辞書のビット積はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列のビット積はできません");if(v1 instanceof FloatValue||v2 instanceof FloatValue)throw new RuntimeError(this.first_line,"実数のビット積はできません");v1 instanceof BooleanValue&&v2 instanceof BooleanValue?v3=new BooleanValue(v1.value&&v2.value,this.loc):(v1 instanceof BooleanValue&&(v1=new IntValue(v1.value?1:0,this.loc)),v2 instanceof BooleanValue&&(v2=new IntValue(v2.value?1:0,this.loc)),v3=new IntValue(v1.value&v2.value,this.loc));break;case"|":if(v1 instanceof ArrayValue||v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列のビット和はできません");if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)throw new RuntimeError(this.first_line,"辞書のビット和はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列のビット和はできません");if(v1 instanceof FloatValue||v2 instanceof FloatValue)throw new RuntimeError(this.first_line,"実数のビット和はできません");v1 instanceof BooleanValue&&v2 instanceof BooleanValue?v3=new BooleanValue(v1.value&&v2.value,this.loc):(v1 instanceof BooleanValue&&(v1=new IntValue(v1.value?1:0,this.loc)),v2 instanceof BooleanValue&&(v2=new IntValue(v2.value?1:0,this.loc)),v3=new IntValue(v1.value|v2.value,this.loc));break;case"^":if(v1 instanceof ArrayValue&&v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列の排他的論理和はできません");if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)throw new RuntimeError(this.first_line,"辞書の排他的論理和はできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列の排他的論理和はできません");if(v1 instanceof FloatValue||v2 instanceof FloatValue)throw new RuntimeError(this.first_line,"実数の排他的論理和はできません");v1 instanceof BooleanValue&&v2 instanceof BooleanValue?v3=new BooleanValue(v1.value&&v2.value,this.loc):(v1 instanceof BooleanValue&&(v1=new IntValue(v1.value?1:0,this.loc)),v2 instanceof BooleanValue&&(v2=new IntValue(v2.value?1:0,this.loc)),v3=new IntValue(v1.value^v2.value,this.loc));break;case"<<":if(v1 instanceof ArrayValue&&v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列のビットシフトはできません");if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)throw new RuntimeError(this.first_line,"辞書のビットシフトはできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列のビットシフトはできません");if(v1 instanceof FloatValue||v2 instanceof FloatValue)throw new RuntimeError(this.first_line,"実数のビットシフトはできません");v1 instanceof BooleanValue&&v2 instanceof BooleanValue?v3=new BooleanValue(v1.value&&v2.value,this.loc):(v1 instanceof BooleanValue&&(v1=new IntValue(v1.value?1:0,this.loc)),v2 instanceof BooleanValue&&(v2=new IntValue(v2.value?1:0,this.loc)),v3=new IntValue(v1.value<<v2.value,this.loc));break;case">>":if(v1 instanceof ArrayValue&&v2 instanceof ArrayValue)throw new RuntimeError(this.first_line,"配列のビットシフトはできません");if(v1 instanceof DictionaryValue||v2 instanceof DictionaryValue)throw new RuntimeError(this.first_line,"辞書のビットシフトはできません");if(v1 instanceof StringValue||v2 instanceof StringValue)throw new RuntimeError(this.first_line,"文字列のビットシフトはできません");if(v1 instanceof FloatValue||v2 instanceof FloatValue)throw new RuntimeError(this.first_line,"実数のビットシフトはできません");v1 instanceof BooleanValue&&v2 instanceof BooleanValue?v3=new BooleanValue(v1.value&&v2.value,this.loc):(v1 instanceof BooleanValue&&(v1=new IntValue(v1.value?1:0,this.loc)),v2 instanceof BooleanValue&&(v2=new IntValue(v2.value?1:0,this.loc)),v3=new IntValue(v1.value>>v2.value,this.loc))}if(!v3)throw new RuntimeError(this.first_line,"複合代入演算子の使い方が間違っています");setVariableByArgs(vt,vn,ag,v3,this.loc)}else setVariableByArgs(vt,vn,ag,vl.clone(),this.loc)}else{if(this.operator)throw new RuntimeError(this.first_line,"宣言されていない変数に複合代入演算子が使われました");vt=varTables[0],vt.vars[vn]=new NullValue(this.loc),setVariableByArgs(vt,vn,ag,vl.clone(),this.loc)}code[0].stack[0].index=index+1}makePython(indent){var code=Parts.makeIndent(indent);return code+=this.variable.makePython()+" ",this.operator&&(code+=this.operator),code+="= "+this.value.makePython()+"\n"}}class Append extends Statement{constructor(variable,value,loc){if(super(loc),!(variable instanceof Variable||variable instanceof UNDEFINED))throw new RuntimeError(loc.first_line,"追加されるものは変数でなくてはいけません");this.variable=variable,this.value=value}clone(){return new Append(this.variable,this.value,this.loc)}run(){if(this.variable instanceof UNDEFINED)throw new RuntimeError(this.first_line,"未完成のプログラムです");let index=code[0].stack[0].index,vn=this.variable.varname,ag=this.variable.args,vl=this.value.getValue(),vt=findVarTable(vn);if(!vt)throw new RuntimeError(this.first_line,"存在しない配列に追加はできません");{let va=vt.vars[vn];if(ag&&ag.value.length>0)for(let i=0;i<ag.value.length;i++)if(ag.value[i].getValue()instanceof StringValue)va=va.value[ag.value[i].getValue().value];else{if(!(ag.value[i].getValue()instanceof IntValue))throw new RuntimeError(this.first_line,"添字に使えないデータ型です");if(!va.value[ag.value[i].getValue().value])throw new RuntimeError(this.first_line,"配列の範囲を超えたところに追加しようとしました");va=va.value[ag.value[i].getValue().value]}if(!(va instanceof ArrayValue))throw new RuntimeError(this.first_line,"配列でない変数に追加はできません");va.value.push(vl.clone())}code[0].stack[0].index=index+1}makePython(indent){var code=Parts.makeIndent(indent);return code+=this.variable.makePython()+".append("+this.value.makePython()+")\n"}}class Extend extends Statement{constructor(variable,value,loc){if(super(loc),!(variable instanceof Variable||variable instanceof UNDEFINED))throw new RuntimeError(loc.first_line,"連結されるものは変数でなくてはいけません");this.variable=variable,this.value=value}clone(){return new Extend(this.variable,this.value,this.loc)}run(){if(this.variable instanceof UNDEFINED)throw new RuntimeError(this.first_line,"未完成のプログラムです");let index=code[0].stack[0].index,vn=this.variable.varname,ag=this.variable.args,vl=this.value.getValue(),vt=findVarTable(vn);if(!vt)throw new RuntimeError(this.first_line,"存在しない配列に連結はできません");{let va=vt.vars[vn];if(ag&&ag.value.length>0)for(let i=0;i<ag.value.length;i++)if(ag.value[i]instanceof StringValue)va=va.value[ag.value[i].getValue().value];else{if(!(ag.value[i]instanceof IntValue))throw new RuntimeError(this.first_line,"添字に使えないデータ型です");if(!va.value[ag.value[i].getValue().value])throw new RuntimeError(this.first_line,"配列の範囲を超えたところに連結しようとしました");va=va.value[ag.value[i].getValue().value]}if(!(va instanceof ArrayValue))throw new RuntimeError(this.first_line,"配列でない変数に連結はできません");if(!(vl instanceof ArrayValue))throw new RuntimeError(this.first_line,"配列でない値を連結することはできません");for(var l=vl.value.length,i=0;i<l;i++)va.value.push(vl.value[i].clone())}code[0].stack[0].index=index+1}makePython(indent){var code=Parts.makeIndent(indent);return code+=this.variable.makePython()+".extend("+this.value.makePython()+")\n"}}class Input extends Statement{constructor(x,type,loc){if(super(loc),!(x instanceof Variable||x instanceof UNDEFINED))throw new RuntimeError(loc.first_line,"入力されるものは変数でなくてはいけません");this.varname=x,this.type=type}clone(){new Input(this.varname,this.type,this.loc)}run(){if(selected_quiz<0){if(this.varname instanceof UNDEFINED)throw new RuntimeError(this.first_line,"未完成のプログラムです");var list=[new InputBegin(this.loc),new InputEnd(this.varname,this.type,this.loc)];code.unshift(new parsedCode(list))}else{if(!(selected_quiz_input<Quizzes[selected_quiz].inputs(selected_quiz_case).length))throw new RuntimeError(this.first_line,"必要以上の入力を求めています。");{let index=code[0].stack[0].index;if(this.varname instanceof UNDEFINED)throw new RuntimeError(this.first_line,"未完成のプログラムです");let va=new Variable(this.varname.varname,this.varname.args,this.loc),vl=Quizzes[selected_quiz].inputs(selected_quiz_case)[selected_quiz_input++],assign=null,re=/^(0+|false|偽|)$/i;this.type==typeOfValue.typeInt?assign=new Assign(va,new IntValue(Number(toHalf(vl,this.loc)),this.loc),null,this.loc):this.type==typeOfValue.typeFloat?assign=new Assign(va,new FloatValue(Number(toHalf(vl,this.loc)),this.loc),null,this.loc):this.type==typeOfValue.typeString?assign=new Assign(va,new StringValue(vl+"",this.loc),null,this.loc):this.type==typeOfValue.typeBoolean&&(assign=new Assign(va,new BooleanValue(!re.exec(vl),this.loc),null,this.loc)),assign.run(),code[0].stack[0].index=index+1}}}makePython(indent){var code=Parts.makeIndent(indent);switch(code+=this.varname.makePython()+" = ",this.type){case typeOfValue.typeInt:code+="int(input())\n";break;case typeOfValue.typeFloat:code+="float(input())\n";break;case typeOfValue.typeString:code+="input()\n";break;case typeOfValue.typeBoolean:code+="bool(input())\n"}return code}}class InputBegin extends Statement{constructor(loc){super(loc)}clone(){return new InputBegin(this.loc)}run(){openInputWindow(),super.run()}}class InputEnd extends Statement{constructor(x,type,loc){super(loc),this.varname=x,this.type=type}clone(){return new InputEnd(this.varname,this.type,this.loc)}run(){if(this.varname instanceof UNDEFINED)throw new RuntimeError(this.first_line,"未完成のプログラムです");try{let va=new Variable(this.varname.varname,this.varname.args,this.loc),vl=closeInputWindow(),assign=null,re=/^(0+|false|偽|)$/i;code.shift();let index=code[0].stack[0].index;this.type==typeOfValue.typeInt?assign=new Assign(va,new IntValue(Number(toHalf(vl,this.loc)),this.loc),null,this.loc):this.type==typeOfValue.typeFloat?assign=new Assign(va,new FloatValue(Number(toHalf(vl,this.loc)),this.loc),null,this.loc):this.type==typeOfValue.typeString?assign=new Assign(va,new StringValue(vl+"",this.loc),null,this.loc):this.type==typeOfValue.typeBoolean&&(assign=new Assign(va,new BooleanValue(!re.exec(vl),this.loc),null,this.loc)),assign.run(),code[0].stack[0].index=index+1}catch(e){throw closeInputWindow(),code.shift(),e}}}class Newline extends Statement{constructor(loc){super(loc)}clone(){return new Newline(this.loc)}run(){selected_quiz<0?textareaAppend("\n"):output_str+="\n",super.run()}makePython(indent){return Parts.makeIndent(indent)+"print()\n"}}class Output extends Statement{constructor(x,ln,loc){super(loc),this.value=x,this.ln=ln}clone(){for(var val=[],i=0;i<this.value.length;i++)val.push(this.value[i]);return new Output(val,this.ln,this.loc)}run(){let index=code[0].stack[0].index;if(selected_quiz<0){for(var i=0;i<this.value.length;i++){let v;textareaAppend((i>0?" ":"")+array2text(this.value[i].getValue()))}this.ln&&textareaAppend("\n")}else{for(var i=0;i<this.value.length;i++){let v=this.value[i].getValue();output_str+=(i>0?" ":"")+array2text(v)}this.ln&&(output_str+="\n")}code[0].stack[0].index=index+1}makePython(indent){var code=Parts.makeIndent(indent);code+="print(";for(var i=0;i<this.value.length;i++)code+=(i>0?",":"")+this.value[i].makePython();return this.ln||(code+=",end=''"),code+")\n"}}function array2text(v){if(!v)return"";if(v instanceof Value){let v0=v.getValue();if(v0 instanceof ArrayValue){let v1=[];for(let i=0;i<v0.value.length;i++)v1.push(array2text(v0.value[i]));return"["+v1.join(",")+"]"}if(v0 instanceof DictionaryValue){let v1=[],keys=Object.keys(v0.value);keys.sort();for(let i=0;i<keys.length;i++)v1.push(keys[i]+":"+array2text(v0.value[keys[i]]));return"{"+v1.join(",")+"}"}return v0 instanceof BooleanValue?v0.value?"True":"False":v0 instanceof FloatValue&&isInteger(v0.value)&&!v0.value.toString().match(/[Ee]/)?v0.value+".0":new String(v0.value)}return new String(v)}function array2code(v){if(!v)return"";let v0=v.getValue();if(v0 instanceof ArrayValue){let v1=[];for(let i=0;i<v0.value.length;i++)v1.push(array2text(v0.value[i]));return"["+v1.join(",")+"]"}if(v0 instanceof DictionaryValue){let v1=[],keys=Object.keys(v0.value);keys.sort();for(let i=0;i<keys.length;i++)v1.push(keys[i]+":"+array2text(v0.value[keys[i]]));return"{"+v1.join(",")+"}"}return v0 instanceof StringValue?'"'+v0.value+'"':v0 instanceof FloatValue&&isInteger(v0.value)&&!v0.value.toString().match(/[Ee]/)?v0.value+".0":v0.value}class GraphicStatement extends Statement{constructor(command,args,loc){super(loc),this.command=command,this.args=args}clone(){for(var args=[],i=0;i<this.args.length;i++)args.push(this.args[i]);return new GraphicStatement(this.command,args,this.loc)}run(){if(super.run(),"gOpenWindow"==this.command){var canvas=document.getElementById("canvas");context=canvas.getContext("2d"),canvas.setAttribute("width",this.args[0].getValue().value+"px"),canvas.setAttribute("height",this.args[1].getValue().value+"px"),canvas.style.display="block"}else if("gCloseWindow"==this.command){var canvas;(canvas=document.getElementById("canvas")).style.display="none",context=null}else if("gClearWindow"==this.command){var canvas=document.getElementById("canvas");context.clearRect(0,0,canvas.width,canvas.height)}else if("gSetLineColor"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");let r=this.args[0].getValue().value,g=this.args[1].getValue().value,b=this.args[2].getValue().value;context.strokeStyle="rgb("+r+","+g+","+b+")"}else if("gSetFillColor"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");let r=this.args[0].getValue().value,g=this.args[1].getValue().value,b=this.args[2].getValue().value;context.fillStyle="rgb("+r+","+g+","+b+")"}else if("gSetTextColor"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");let r=this.args[0].getValue().value,g=this.args[1].getValue().value,b=this.args[2].getValue().value;context.textStyle="rgb("+r+","+g+","+b+")"}else if("gSetLineWidth"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");context.lineWidth=this.args[0].getValue().value}else if("gSetFontSize"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");context.font=this.args[0].getValue().value+"px 'sans-serif'"}else if("gDrawText"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");var temp=context.fillStyle;context.fillStyle=context.textStyle,context.fillText(this.args[0].getValue().value,this.args[1].getValue().value,this.args[2].getValue().value),context.fillStyle=temp}else if("gDrawLine"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=this.args[0].getValue().value,y1=this.args[1].getValue().value,x2=this.args[2].getValue().value,y2=this.args[3].getValue().value;context.beginPath(),context.moveTo(x1,y1),context.lineTo(x2,y2),context.stroke()}else if("gDrawPoint"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=this.args[0].getValue().value,y1=this.args[1].getValue().value;context.beginPath(),context.arc(x1,y1,1,0,2*Math.PI,!1),context.stroke()}else if("gDrawBox"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=this.args[0].getValue().value,y1=this.args[1].getValue().value,width=this.args[2].getValue().value,height=this.args[3].getValue().value;context.beginPath(),context.strokeRect(x1,y1,width,height),context.stroke()}else if("gFillBox"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=this.args[0].getValue().value,y1=this.args[1].getValue().value,width=this.args[2].getValue().value,height=this.args[3].getValue().value;context.fillRect(x1,y1,width,height),context.beginPath(),context.strokeRect(x1,y1,width,height),context.stroke()}else if("gDrawCircle"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=this.args[0].getValue().value,y1=this.args[1].getValue().value,r=this.args[2].getValue().value;context.beginPath(),context.arc(x1,y1,r,0,2*Math.PI,!1),context.stroke()}else if("gFillCircle"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=this.args[0].getValue().value,y1=this.args[1].getValue().value,r=this.args[2].getValue().value;for(var i=0;i<2;i++)context.beginPath(),context.arc(x1,y1,r,0,2*Math.PI,!1),0==i?context.fill():context.stroke()}else if("gDrawOval"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=this.args[0].getValue().value,y1=this.args[1].getValue().value,w=this.args[2].getValue().value,h=this.args[3].getValue().value;context.beginPath(),context.ellipse(x1+w/2,y1+h/2,w/2,h/2,0,0,2*Math.PI),context.stroke()}else if("gFillOval"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=this.args[0].getValue().value,y1=this.args[1].getValue().value,w=this.args[2].getValue().value,h=this.args[3].getValue().value;for(var i=0;i<2;i++)context.beginPath(),context.ellipse(x1+w/2,y1+h/2,w/2,h/2,0,0,2*Math.PI),0==i?context.fill():context.stroke()}else if("gDrawArc"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=this.args[0].getValue().value,y1=this.args[1].getValue().value,w=this.args[2].getValue().value,h=this.args[3].getValue().value,theta1=this.args[4].getValue().value,theta2=this.args[5].getValue().value,style=this.args[6].getValue().value;switch(context.beginPath(),context.ellipse(x1+w/2,y1+h/2,w/2,h/2,0,-theta1*Math.PI/180,-theta2*Math.PI/180,!0),style){case 2:context.lineTo(x1+w/2,y1+h/2);case 1:context.closePath()}context.stroke()}else if("gFillArc"==this.command){if(null==context)throw new RuntimeError(this.first_line,"描画領域がありません");let x1=this.args[0].getValue().value,y1=this.args[1].getValue().value,w=this.args[2].getValue().value,h=this.args[3].getValue().value,theta1=this.args[4].getValue().value,theta2=this.args[5].getValue().value,style=this.args[6].getValue().value;for(var i=0;i<2;i++){switch(context.beginPath(),context.ellipse(x1+w/2,y1+h/2,w/2,h/2,0,-theta1*Math.PI/180,-theta2*Math.PI/180,!0),style){case 2:context.lineTo(x1+w/2,y1+h/2);case 1:context.closePath()}0==i?context.fill():context.stroke()}}else if("gBarplot"==this.command){if(null==context){var canvas=document.getElementById("canvas"),w=this.args[0].getValue().value,h=this.args[1].getValue().value;context=canvas.getContext("2d"),canvas.setAttribute("width",w+"px"),canvas.setAttribute("height",h+"px"),canvas.style.display="block"}for(var values=array2values(this.args[2],this.loc),max=0,min=0,maxn=0,i=0;i<values.length;i++){var l;(l=values[i].length)>maxn&&(maxn=l);for(var j=0;j<l;j++){var v1;(v1=values[i][j])>max&&(max=v1),v1<min&&(min=v1)}}0==max&&(max=1);var x0=.05*w,y0=.95*h;if(y0*=max/(max-min),w*=.9,h*=.9,context.beginPath(),context.moveTo(x0,y0-h*max/(max-min)),context.lineTo(x0,y0-h*min/(max-min)),context.moveTo(x0,y0),context.lineTo(x0+w,y0),context.stroke(),values.length>0)for(var w0=w/maxn/values.length,i=0;i<values.length;i++){context.fillStyle=graphColor[i%6],context.beginPath();for(var j=0;j<values[i].length;j++){var x=x0+w0*j+w0/2,y=y0-values[i][j]/(max-min)*h;values[i][j]>=0?context.fillRect(x0+w0*j*values.length+.8*w0*i+.1*w0,y0-h*(values[i][j]/(max-min)),.8*w0,h*(values[i][j]/(max-min))):context.fillRect(x0+w0*j*values.length+.8*w0*i+.1*w0,y0,.8*w0,h*(-values[i][j]/(max-min)))}context.stroke()}}else if("gLineplot"==this.command){if(null==context){var canvas=document.getElementById("canvas"),w=this.args[0].getValue().value,h=this.args[1].getValue().value;context=canvas.getContext("2d"),canvas.setAttribute("width",w+"px"),canvas.setAttribute("height",h+"px"),canvas.style.display="block"}for(var values=array2values(this.args[2],this.loc),max=0,min=0,maxn=0,i=0;i<values.length;i++){var l;(l=values[i].length)>maxn&&(maxn=l);for(var j=0;j<l;j++){var v1;(v1=values[i][j])>max&&(max=v1),v1<min&&(min=v1)}}0==max&&(max=1);var x0=.05*w,y0=.95*h;if(y0*=max/(max-min),w*=.9,h*=.9,context.beginPath(),context.moveTo(x0,y0-h*max/(max-min)),context.lineTo(x0,y0-h*min/(max-min)),context.moveTo(x0,y0),context.lineTo(x0+w,y0),context.stroke(),values.length>0)for(var w0=w/maxn,i=0;i<values.length;i++){context.strokeStyle=graphColor[i%6],context.beginPath();for(var j=0;j<values[i].length;j++){var x=x0+w0*j+w0/2,y=y0-values[i][j]/(max-min)*h;0==j?context.moveTo(x,y):context.lineTo(x,y)}context.stroke()}}else if("gDrawGraph"==this.command)drawGraph(this.args[0].getValue(),this.args[1].getValue(),this.loc);else{if("gClearGraph"!=this.command)throw new RuntimeError(this.first_line,"未実装のコマンド"+this.command+"が使われました");clearGraph()}}makePython(indent){throw new RuntimeError(this.first_line,"グラフィック命令はPythonに変換できません")}}function clearGraph(){Plotly.purge(document.getElementById("graph"))}function drawGraph(layout,data,loc){var div=document.getElementById("graph"),graph_data=[],graph_layout={};if(layout instanceof DictionaryValue)for(var key in layout.value){var val;if((val=layout.value[key].getValue())instanceof ArrayValue)for(var key1 in graph_layout[key]={},val.value)graph_layout[key][key1]=val2obj(val.value[key1].getValue());else graph_layout[key]=val2obj(val)}else if(layout)throw new RuntimeError(loc.first_line,"レイアウト情報が辞書になっていません");if(!(data instanceof ArrayValue))throw new RuntimeError(loc.first_line,"データが配列になっていません");for(var dl=data.value.length,i=0;i<dl;i++){var d=data.value[i].getValue();if(!(d instanceof DictionaryValue))throw new RuntimeError(loc.first_line,"データの"+i+"番目の要素が辞書になっていません");var va={};for(var key in d.value){var val=d.value[key].getValue();va[key]=val2obj(val)}graph_data.push(va)}Plotly.newPlot(div,graph_data,graph_layout)}function val2obj(val){if(val instanceof ArrayValue){for(var rtnv=[],l=val.value.length,i=0;i<l;i++)rtnv.push(val2obj(val.value[i]));return rtnv}if(val instanceof DictionaryValue){var rtnv={};for(var key in val.value)rtnv[key]=val2obj(val.value[key].getValue());return rtnv}return val.value}function array2values(a,loc){var rtnv=[],array=null;if(a.rtnv instanceof ArrayValue)if(a.rtnv.value[0]instanceof ArrayValue)array=a.rtnv;else{if(!(a.rtnv.value instanceof Array))throw new RuntimeError(loc.first_line,"グラフに誤った型が使われています");array=new ArrayValue([a.rtnv.value],loc)}else{if(!(a.rtnv instanceof Array))throw new RuntimeError(loc.first_line,"棒グラフ・線グラフには配列が必要です");array=new ArrayValue(a.rtnv,loc)}for(var i=0;i<array.length;i++){for(var rtnv1=[],j=0;j<array.value[i].length;j++)rtnv1.push(array.value[i]instanceof ArrayValue?array.value[i].value[j].value:array.value[i][j].value);rtnv.push(rtnv1)}return rtnv}class If extends Statement{constructor(condition,state1,state2,loc){super(loc),this.condition=condition,this.state1=state1,this.state2=state2}clone(){var state1=[],state2=[];if(this.state1)for(var i=0;i<this.state1.length;i++)state1.push(this.state1[i].clone());if(this.state2)for(var i=0;i<this.state2.length;i++)state2.push(this.state2[i].clone());return new If(this.condition,state1,state2,this.loc)}run(){if(super.run(),!(this.condition.getValue()instanceof BooleanValue))throw new RuntimeError(this.first_line,"もし〜の構文で条件式が使われていません");this.condition.getValue().value?code[0].stack.unshift({statementlist:this.state1,index:0}):null!=this.state2&&code[0].stack.unshift({statementlist:this.state2,index:0})}makePython(indent){var code=Parts.makeIndent(indent);code+="if "+this.condition.makePython()+":\n";var codes=0;if(this.state1)for(var i=0;i<this.state1.length;i++)this.state1[i]&&(code+=this.state1[i].makePython(indent+1),codes=1);if(0==codes&&(code+=Parts.makeIndent(indent+1)+"None\n"),this.state2){codes=0;for(var code2="",i=0;i<this.state2.length;i++)this.state2[i]&&(code2+=this.state2[i].makePython(indent+1),codes=1);codes>0&&(code+=Parts.makeIndent(indent)+"else:\n"+code2)}return code}}class LoopBegin extends Statement{constructor(condition,continuous,loc){super(loc),this.condition=condition,this.continuous=continuous}clone(){return new LoopBegin(this.condifion.clone(),this.condition,this.loc)}run(){null==this.condition||this.condition.getValue().value==this.continuous?super.run():code[0].stack[0].index=-1}}class LoopEnd extends Statement{constructor(condition,continuous,loc){super(loc),this.condition=condition,this.continuous=continuous}clone(){return new LoopEnd(this.condition.clone(),this.continuous,this.loc)}run(){null==this.condition||this.condition.getValue().value==this.continuous?code[0].stack[0].index=0:code[0].stack[0].index=-1}}class ForInc extends Statement{constructor(varname,begin,end,step,statementlist,loc){if(super(loc),!(varname instanceof Variable||varname instanceof UNDEFINED))throw new RuntimeError(loc.first_line,"繰り返しのカウンタは変数でなくてはいけません");this.varname=varname,this.begin=begin,this.end=end,this.step=step,this.statementlist=statementlist}clone(){for(var state=[],i=0;i<this.statementlist.length;i++)state.push(this.statementlist[i].clone());return new ForInc(this.varname.clone(),this.begin.clone(),this.end.clone(),this.step.clone(),state,this.loc)}makePython(indent){var code=Parts.makeIndent(indent),pv,pb,pe,ps;code+="for "+this.varname.makePython()+" in range("+this.begin.makePython()+","+this.end.makePython()+"+1,"+this.step.makePython()+"):\n";for(var codes=0,i=0;i<this.statementlist.length;i++)this.statementlist[i]&&(codes=1,code+=this.statementlist[i].makePython(indent+1));return 0==codes&&(code+=Parts.makeIndent(indent+1)+"None\n"),code}run(){let index=code[0].stack[0].index;if(this.varname instanceof UNDEFINED)throw new RuntimeError(this.first_line,"未完成のプログラムです");let varTable=findVarTable(this.varname.varname);if(varTable||(varTable=varTables[0],this.begin.getValue()instanceof IntValue?varTable.vars[this.varname.varname]=new IntValue(0,this.loc):this.begin.getValue()instanceof FloatValue?varTable.vars[this.varname.varname]=new FloatValue(0,this.loc):varTable=null),!varTable)throw new RuntimeError(this.first_line,this.varname.varname+"は数値型の変数ではありません");{let assign;new Assign(this.varname,this.begin.getValue(),null,this.loc).run();let loop=[];loop.push(new runBeforeGetValue([this.varname.args],this.loc));let variable=new Variable(this.varname.varname,this.varname.args,this.loc);loop.push(new runBeforeGetValue([variable,this.end],this.loc));let condition=new LE(variable,this.end,this.loc);loop.push(new runBeforeGetValue([condition],this.loc)),loop.push(new LoopBegin(condition,!0,this.loc));for(let i=0;i<this.statementlist.length;i++)loop.push(this.statementlist[i]);loop.push(new runBeforeGetValue([this.step,this.varname.args],this.loc));let new_counter=new Add(variable,this.step,this.loc);loop.push(new runBeforeGetValue([variable,new_counter],this.loc)),loop.push(new Assign(this.varname,new_counter,null,this.loc)),loop.push(new LoopEnd(null,!0,this.loc)),code[0].stack.unshift({statementlist:loop,index:0}),code[0].stack[1].index=index+1}}}class ForDec extends Statement{constructor(varname,begin,end,step,statementlist,loc){if(super(loc),!(varname instanceof Variable||varname instanceof Variable))throw new RuntimeError(loc.first_line,"繰り返しのカウンタは変数でなくてはいけません");this.varname=varname,this.begin=begin,this.end=end,this.step=step,this.statementlist=statementlist}clone(){for(var state=[],i=0;i<this.statementlist.length;i++)state.push(this.statementlist[i].clone());return new ForInc(this.varname.clone(),this.begin.clone(),this.end.clone(),this.step.clone(),state,this.loc)}makePython(indent){var code=Parts.makeIndent(indent),pv,pb,pe,ps;code+="for "+this.varname.makePython()+" in range("+this.begin.makePython()+","+this.end.makePython()+"-1,-"+this.step.makePython()+"):\n";for(var codes=0,i=0;i<this.statementlist.length;i++)this.statementlist[i]&&(codes=1,code+=this.statementlist[i].makePython(indent+1));return 0==codes&&(code+=Parts.makeIndent(indent+1)+"None\n"),code}run(){if(this.varname instanceof UNDEFINED)throw new RuntimeError(this.first_line,"未完成のプログラムです");let varTable=findVarTable(this.varname.varname);if(varTable||(varTable=varTables[0],this.begin.getValue()instanceof IntValue?varTable.vars[this.varname.varname]=new IntValue(0,this.loc):this.begin.getValue()instanceof FloatValue?varTable.vars[this.varname.varname]=new FloatValue(0,this.loc):varTable=null),!varTable)throw new RuntimeError(this.first_line,this.varname.varname+"は数値型の変数ではありません");{let assign;new Assign(this.varname,this.begin.getValue(),null,this.loc).run();let loop=[];loop.push(new runBeforeGetValue([this.varname.args],this.loc));let variable=new Variable(this.varname.varname,this.varname.args,this.loc);loop.push(new runBeforeGetValue([variable,this.end],this.loc));let condition=new GE(variable,this.end,this.loc);loop.push(new runBeforeGetValue([condition],this.loc)),loop.push(new LoopBegin(condition,!0,this.loc));for(let i=0;i<this.statementlist.length;i++)loop.push(this.statementlist[i]);loop.push(new runBeforeGetValue([this.step,this.varname.args],this.loc));let new_counter=new Sub(variable,this.step,this.loc);loop.push(new runBeforeGetValue([variable,new_counter],this.loc)),loop.push(new Assign(this.varname,new_counter,null,this.loc)),loop.push(new LoopEnd(null,!0,this.loc)),code[0].stack.unshift({statementlist:loop,index:0})}super.run()}}class While extends Statement{constructor(condition,statementlist,loc){super(loc),this.condition=condition,this.statementlist=statementlist}clone(){for(var state=[],i=0;i<this.statementlist.length;i++)state.push(this.statementlist[i].clone());return new While(this.condition.clone(),state,this.loc)}makePython(indent){var code=Parts.makeIndent(indent);code+="while "+this.condition.makePython()+":\n";for(var codes=0,i=0;i<this.statementlist.length;i++)this.statementlist[i]&&(codes=1,code+=this.statementlist[i].makePython(indent+1));return 0==codes&&(code+=Parts.makeIndent(indent+1)+"None\n"),code}run(){super.run();let loop=[new runBeforeGetValue([this.condition],this.loc),new LoopBegin(this.condition,!0,this.loc)];for(var i=0;i<this.statementlist.length;i++)loop.push(this.statementlist[i]);loop.push(new LoopEnd(null,!1,this.loc)),code[0].stack.unshift({statementlist:loop,index:0})}}class SleepStatement extends Statement{constructor(sec,loc){super(loc),this.sec=new IntValue(sec.value,loc)}clone(){return new SleepStatement(this.sec,this.loc)}run(){wait_time=this.sec.value,super.run()}makePython(indent){var code=Parts.makeIndent(indent);return python_lib.time=1,code+"time.sleep("+this.sec.makePython()+"/1000)\n"}}class NopStatement extends Statement{constructor(loc){super(loc)}clone(){return new NopStatement(this.loc)}run(){super.run()}makePython(indent){return Parts.makeIndent(indent)+"None\n"}}class PauseStatement extends Statement{constructor(loc){super(loc)}clone(){return new PauseStatement(this.loc)}run(){super.run()}makePython(indent){return""}}class BreakStatement extends Statement{constructor(loc){super(loc)}clone(){return new BreakStatement(this.loc)}run(){for(;;){var block=code[0].stack.shift();if(!block)throw new RuntimeError(this.first_line,"繰り返しの中ではありません。");for(var i=0;i<block.statementlist.length;i++)if(block.statementlist[i]instanceof LoopBegin)return}}makePython(indent){return Parts.makeIndent(indent)+"break\n"}}function highlightLine(l){var scroll_elem,code_elems=editor.getScrollerElement().getElementsByClassName("CodeMirror-code");if(code_elems)for(var code_elem,ln=1,line_elem=code_elems[0].firstElementChild;line_elem;line_elem=line_elem.nextElementSibling){var number_elems=line_elem.getElementsByClassName("CodeMirror-linenumber");if(number_elems){var number_elem=number_elems[0];ln++==l?(number_elem.style.background="red",number_elem.style.color="white"):(number_elem.style.background="transparent",number_elem.style.color="#999")}}}function reset(){var canvas;varTables=[new varTable],myFuncs={},current_line=-1,selected_quiz<0&&textareaClear(),setRunflag(!1),code=null,highlightLine(-1),returnValues=[],document.getElementById("canvas").style.display="none";var input_area=document.getElementById("input_area");input_area.readOnly=!0,input_area.value="",document.getElementById("input_status").style.visibility="hidden",context=null,wait_time=0,timeouts=[],selected_quiz_input=selected_quiz_output=0,output_str="",Plotly.purge(document.getElementById("graph"))}function setRunflag(b){run_flag=b,document.getElementById("sourceTextarea").readOnly=b,editor.options.readOnly=b,b?editor.getWrapperElement().classList.add("readonly"):editor.getWrapperElement().classList.remove("readonly"),document.getElementById("runButton").innerHTML=b&!step_flag?"中断":"実行",document.getElementById("dumpButton").disabled=!step_flag,setEditableflag(!b)}function setEditableflag(b){editable_flag=b,document.getElementById("drawButton").disabled=!b,document.getElementById("pythonButton").disabled=!b,document.getElementById("urlButton").disabled=!b}function run(){if(null==code)try{reset();var python_source=editor.getValue(),dncl_source=python_to_dncl(python_source);code=[new parsedMainRoutine(dncl.parse(dncl_source))]}catch(e){if(selected_quiz<0)return e.line&&textareaAppend(e.line+"行目"),textareaAppend("構文エラーです\n"+e.message+"\n"),setRunflag(!1),void(code=null);throw e}setRunflag(!0),step()}function wait(ms){let t1=Date.now();for(;Date.now()-t1<ms;);}function step(){if(selected_quiz<0){var l=current_line;do{next_line()}while(run_flag&&l==current_line);if(!code)return;code[0]&&code[0].stack.length>0?run_flag&&!step_flag&&(wait_time>0&&(wait(wait_time),wait_time=0),setZeroTimeout(step,0)):finish()}else do{if(next_line(),Date.now()>test_limit_time)throw new RuntimeError(-1,"時間がかかりすぎです。")}while(run_flag&&code[0]&&code[0].stack.length>0)}function next_line(){var index=code[0].stack[0].index,statement=code[0].stack[0].statementlist[index];if(statement)try{statement.run()}catch(e){if(!(selected_quiz<0))throw e;textareaAppend(e instanceof RuntimeError?"実行時エラーです\n"+e.line+"行目:"+e.message+"\n":"実行時エラーです\n"+e+"\n"),setRunflag(!1),code=null}else code[0].stack[0].index++;if(code&&code[0]){for(index=code[0].stack[0]?code[0].stack[0].index:-1;(index<0||index>=code[0].stack[0].statementlist.length)&&(code[0].stack.shift(),code[0].stack.length<1&&code.shift(),!(code.length<1));)index=code[0]&&code[0].stack[0]?code[0].stack[0].index:-1;selected_quiz<0&&(code[0]&&code[0].stack[0]?(index=code[0].stack[0].index,(statement=code[0].stack[0].statementlist[index])&&statement instanceof Statement&&(statement.loc&&highlightLine(current_line=statement.first_line),statement instanceof PauseStatement&&(step_flag=!0))):highlightLine(++current_line))}}function openInputWindow(){setRunflag(!1),setEditableflag(!1);var input_area=document.getElementById("input_area");input_area.value="",input_area.readOnly=!1,input_area.focus(),document.getElementById("input_status").style.visibility="visible",document.getElementById("sourceTextarea").readOnly=!0,editor.options.readOnly=!0,editor.getWrapperElement().classList.add("readonly")}function closeInputWindow(){var val=document.getElementById("input_area").value;return document.getElementById("input_area").readOnly=!0,document.getElementById("input_status").style.visibility="hidden",val}function keydownInput(e){var evt=e||window.event;13==evt.keyCode?(setRunflag(!0),step()):27==evt.keyCode&&(closeInputWindow(),code.shift())}function editButton(add_code){if(document.getElementById("sourceTextarea").readOnly)window.alert("プログラム実行・中断中はプログラムを編集できません");else{var pos=editor.getCursor(),code=editor.getValue(),lines=code.split(/\r|\n|\r\n/),code1=lines[pos.line].slice(0,pos.ch),code2=lines[pos.line].slice(pos.ch,code.length),re1=/^[｜| 　]*$/,add_codes=add_code.split("\n"),tab="",array=re1.exec(code1);if(array&&(tab=array[0]),code2)return alert("カーソルの右側に文字や空白があるときに\n入力支援ボタンを押してはいけません"),void editor.focus();for(var c in add_codes)add_codes[c]=tab+add_codes[c];(code=lines.slice(0,pos.line).join("\n"))&&(code+="\n"),code+=add_codes.join("\n")+"\n",code+=lines.slice(pos.line+1,lines.length).join("\n"),editor.setValue(code),editor.setCursor({line:pos.line,ch:pos.ch}),editor.focus()}}function keyDown(e){var evt=e||window.event,sourceTextArea=document.getElementById("sourceTextarea"),pos1=sourceTextArea.selectionStart,pos2=sourceTextArea.selectionEnd,code=sourceTextArea.value,code1=code.slice(0,pos1),code2=code.slice(pos1,pos2),code3=code.slice(pos2,code.length),re1=/^(    |　　|  　| 　 |　  )/,re2=/(    |　　|  　| 　 |　  )$/,tab="    ";switch(evt.keyCode){case 9:if(evt.shiftKey)re2.exec(code1)?code1=code1.replace(re2,""):pos1==pos2?re1.exec(code3)&&(code3=code3.replace(re1,"")):code2=code2.replace(/([\n])(    |　　|  　| 　 |　  )/g,"$1").replace(/^(    |　　|  　| 　 |　  )/,""),sourceTextArea.value=code1+code2+code3,sourceTextArea.setSelectionRange(code1.length,code1.length+code2.length);else{pos1<pos2&&(code2=code2.replace(/\n([^$])/g,"\n    $1")),sourceTextArea.value=code1+tab+code2+code3;var pos3=code1.length+tab.length,pos4=pos3;pos1<pos2&&(pos4=pos3+code2.length,pos3-=tab.length),sourceTextArea.setSelectionRange(pos3,pos4)}return evt.preventDefault(),!1;case 8:return code1=re2.exec(code1)?code1.replace(re2,""):code1.slice(0,-1),sourceTextArea.value=code1+code3,sourceTextArea.setSelectionRange(code1.length,code1.length),evt.preventDefault(),!1}return!0}function keyUp(e){var evt;switch((e||window.event).keyCode){case 37:case 38:case 39:case 40:var pos=editor.getCursor(),lines=editor.getValue().split(/\r|\n|\r\n/),line1=lines[pos.line].slice(0,pos.ch),line2=lines[pos.line].slice(pos.ch),re1,re2=/^[^》《]*》/,match1=/《[^》《]*$/.exec(line1),match2=re2.exec(line2);if(match1&&match2){var start=pos.ch-match1[0].length,end=pos.ch+match2[0].length;editor.setSelection({line:pos.line,ch:end},{line:pos.line,ch:start})}}}function mouseClick(evt){var pos=editor.coordsChar({left:evt.x,top:evt.y}),lines=editor.getValue().split(/\r|\n|\r\n/),line1=lines[pos.line].slice(0,pos.ch),line2=lines[pos.line].slice(pos.ch-1),re1,re2=/^[^》《]*》/,match1=/《[^》《]*$/.exec(line1),match2=re2.exec(line2);if(match1&&match2){var start=pos.ch-match1[0].length,end=pos.ch+match2[0].length-1;editor.setSelection({line:pos.line,ch:end},{line:pos.line,ch:start})}}function sampleButton(num){dirty&&!window.confirm("プログラムをサンプルプログラムに変更していいですか？")||(editor.setValue(sample[num]),reset(),flowchart&&codeChange(),editor.focus(),makeDirty(!1))}function insertCode(add_code){document.getElementById("sourceTextarea").readOnly?window.alert("プログラム実行・中断中はプログラムを編集できません"):editor.replaceSelection(add_code)}function registerEvent(elem,ev,func){elem.addEventListener?elem.addEventListener(ev,func):elem.attachEvent&&elem.attachEvent("on"+ev,func)}var dragging=!1,mouseX,mouseY;class point{constructor(){this._x=this._y=0}get x(){return this._x}set x(v){this._x=v}get y(){return this._y}set y(v){this._y=v}clone(){var p=new point;return p.x=this.x,p.y=this.y,p}}function mouseDown(e){var rect=document.getElementById("flowchart").getBoundingClientRect(),x=e.clientX-rect.left,y=e.clientY-rect.top,parts;null!=flowchart.findParts(x,y)&&(dragging=!0,mouseX=x,mouseY=y)}function mouseUp(e){dragging=!1}function mouseMove(e){if(dragging){var rect=document.getElementById("flowchart").getBoundingClientRect(),x=e.clientX-rect.left,y=e.clientY-rect.top;flowchart.moveOrigin(x-mouseX,y-mouseY),mouseX=x,mouseY=y,flowchart.paint()}}function doubleclick_Flowchart(evt){if(editable_flag){dragging=!1;var rect=evt.target.getBoundingClientRect(),x=evt.clientX-rect.left,y=evt.clientY-rect.top,parts=flowchart.findParts(x,y);null==parts||parts instanceof Parts_Terminal||parts instanceof Parts_Bar||parts instanceof Parts_Null||parts.editMe()}else alert("プログラム実行・中断中はプログラムを編集できません")}function variableChange(e){flowchart.flowchart2code(),makeDirty(!0)}function contextMenu_Flowchart(trigger,event){dragging=!1;var x=event.offsetX,y=event.offsetY,parts=flowchart.findParts(x,y);return!(null==parts||parts instanceof Parts_Terminal||parts instanceof Parts_Null)&&(parts instanceof Parts_Bar?{selectableSubMenu:!0,events:{show:function(){parts.highlight()},hide:function(){flowchart.paint(),flowchart.flowchart2code()}},callback:function(k,e){callbackPartsBar(parts,k)},items:{input:{name:"入力",icon:"input"},output:{name:"出力",icon:"output"},substitute:{name:"代入",icon:"assign"},if:{name:"分岐",icon:"if"},loop:{name:"ループ",icon:"loop",items:{loop1:{name:"〜の間"},loopinc:{name:"増やしながら"},loopdec:{name:"減らしながら"}}},array:{name:"配列操作",items:{append:{name:"追加"},extend:{name:"連結"}}},misc:{name:"各種命令"}}}:{callback:function(k,e){callbackParts(parts,k)},events:{show:function(){parts.highlight()},hide:function(){flowchart.paint(),flowchart.flowchart2code()}},items:{edit:{name:"編集"},delete:{name:"削除"}}})}function callbackPartsBar(bar,key){if(document.getElementById("sourceTextarea").readOnly)window.alert("プログラム実行・中断中はプログラムを編集できません");else{if(bar.highlight(),"input"==key)Parts_Input.appendMe(bar);else if("output"==key)Parts_Output.appendMe(bar);else if("substitute"==key)Parts_Substitute.appendMe(bar);else if("append"==key)Parts_Append.appendMe(bar);else if("extend"==key)Parts_Extend.appendMe(bar);else if("if"==key)Parts_If.appendMe(bar);else if("loop1"==key)Parts_LoopBegin1.appendMe(bar);else if("loopinc"==key)Parts_LoopBeginInc.appendMe(bar);else if("loopdec"==key)Parts_LoopBeginDec.appendMe(bar);else{if("misc"!=key)return;Parts_Misc.appendMe(bar)}makeDirty(!0)}}function callbackParts(parts,key){if(!document.getElementById("sourceTextarea").readOnly)return!(parts instanceof Parts_Terminal)&&void("edit"==key?parts.editMe():"delete"==key?(parts.deleteMe(),makeDirty(!0)):"cut"==key&&(parts.cutMe(),makeDirty(!0)));window.alert("プログラム実行・中断中はプログラムを編集できません")}var FlowchartSetting={size:6,fontsize:12};function changeSize(v){v>0?FlowchartSetting.size++:v<0?FlowchartSetting.size>3&&FlowchartSetting.size--:FlowchartSetting.size=6,flowchart.paint()}function variable2code(ty,id){var code=document.getElementById(id).value.trim();return""!=code?ty+" "+code+"\n":""}class Flowchart{constructor(){this._canvas=document.getElementById("flowchart"),this._context=this._canvas.getContext("2d"),this.makeEmpty()}get x0(){return this._x0}get y0(){return this._y0}get canvas(){return this._canvas}get context(){return this._context}setOrigin(x,y){this._x0=x,this._y0=y}moveOrigin(x,y){this._x0+=x,this._y0+=y}makeEmpty(){this.setOrigin(this.canvas.width/2,FlowchartSetting.size),this.top=new Parts_Terminal;var bar=new Parts_Bar,end=new Parts_Terminal;this.top.next=bar,bar.next=end,this.top.setValue("はじめ"),end.setValue("おわり")}code2flowchart(parse){flowchart.makeEmpty(),Flowchart.appendParts(this.top.next,parse),flowchart.paint()}static appendParts(parts,statementlist){for(var i=0;i<statementlist.length;i++){var p=statementlist[i];if(p){var statement=constructor_name(p);if("Assign"==statement){var p1=new Parts_Substitute,b1=new Parts_Bar;p1.setValue(p.variable.getCode(),p.value.getCode(),p.operator),parts.next=p1,parts=p1.next=b1}else if("Append"==statement){var p1=new Parts_Append,b1=new Parts_Bar;p1.setValue(p.variable.getCode(),p.value.getCode()),parts.next=p1,parts=p1.next=b1}else if("Extend"==statement){var p1=new Parts_Extend,b1=new Parts_Bar;p1.setValue(p.variable.getCode(),p.value.getCode()),parts.next=p1,parts=p1.next=b1}else if("Input"==statement){var p1=new Parts_Input,b1=new Parts_Bar;p1.setValue(p.varname.getCode(),p.type),parts.next=p1,parts=p1.next=b1}else if("Output"==statement){for(var p1=new Parts_Output,b1=new Parts_Bar,v0=[],j=0;j<p.value.length;j++)v0.push(p.value[j].getCode());p1.setValue(v0.join(","),p.ln),parts.next=p1,parts=p1.next=b1}else if("Newline"==statement){var p1=new Parts_Output,b1=new Parts_Bar;p1.setValue("改行",!0),parts.next=p1,parts=p1.next=b1}else if("If"==statement){var p1=new Parts_If,b1=new Parts_Bar,b2=new Parts_Bar,b3=new Parts_Bar,n1=new Parts_Null,n2=new Parts_Null,n3=new Parts_Null;p1.setValue(p.condition.getCode()),parts.next=p1,p1.next=n1,n1.next=b1,p1.left=b2,b2._prev=p1,b2.next=n2,p1.right=b3,b3._prev=p1,b3.next=n3,p.state1&&Flowchart.appendParts(b2,p.state1),p.state2&&Flowchart.appendParts(b3,p.state2),parts=b1}else if("ForInc"==statement){var p1=new Parts_LoopBeginInc,p2=new Parts_LoopEnd,b1=new Parts_Bar,b2=new Parts_Bar;p1.setValue(p.varname.getCode(),p.begin.getCode(),p.end.getCode(),p.step.getCode()),parts.next=p1,p1.next=b1,b1.next=p2,p2.next=b2,p1._end=p2,p2._begin=p1,Flowchart.appendParts(b1,p.statementlist),parts=b2}else if("ForDec"==statement){var p1=new Parts_LoopBeginDec,p2=new Parts_LoopEnd,b1=new Parts_Bar,b2=new Parts_Bar;p1.setValue(p.varname.getCode(),p.begin.getCode(),p.end.getCode(),p.step.getCode()),parts.next=p1,p1.next=b1,b1.next=p2,p2.next=b2,p1._end=p2,p2._begin=p1,Flowchart.appendParts(b1,p.statementlist),parts=b2}else if("While"==statement){var p1=new Parts_LoopBegin1,p2=new Parts_LoopEnd,b1=new Parts_Bar,b2=new Parts_Bar;p1.setValue(p.condition.getCode()),parts.next=p1,p1.next=b1,b1.next=p2,p2.next=b2,p1._end=p2,p2._begin=p1,Flowchart.appendParts(b1,p.statementlist),parts=b2}else if("GraphicStatement"==statement){var p1=new Parts_Misc,b1=new Parts_Bar;p1.setValue(p.command,p.args),parts.next=p1,parts=p1.next=b1}else if("SleepStatement"==statement){var p1=new Parts_Misc,b1=new Parts_Bar;p1.setValue("sleep",[p.sec]),parts.next=p1,parts=p1.next=b1}else if("BreakStatement"==statement){var p1=new Parts_Misc,b1=new Parts_Bar;p1.setValue("break",[]),parts.next=p1,parts=p1.next=b1}else if("DumpStatement"==statement){var p1=new Parts_Misc,b1=new Parts_Bar;p1.setValue("dump",[]),parts.next=p1,parts=p1.next=b1}else if("NopStatement"==statement){var p1=new Parts_Misc,b1=new Parts_Bar;p1.setValue("NopStatement",[]),parts.next=p1,parts=p1.next=b1}else if("PauseStatement"==statement){var p1=new Parts_Misc,b1=new Parts_Bar;p1.setValue("PauseStatement",[]),parts.next=p1,parts=p1.next=b1}}}}flowchart2code(){if(flowchart_display){var newcode=this.top.appendCode("",0);editor.setValue(newcode),editor.focus()}}paint(){if(flowchart_display){var canvas_width=this.canvas.width,canvas_height=this.canvas.height,p0=new point,p1=new point,p2=new point;this.context.clearRect(0,0,canvas_width,canvas_height),FlowchartSetting.fontsize=2*FlowchartSetting.size,this.context.font=FlowchartSetting.fontsize+"px 'sans-serif'",this.context.strokeStyle="rgb(0,0,0)",this.context.fillStyle="rgb(0,0,0)",this.context.lineWidth="1px",this.top.calcSize(p0,p1,p2),this.top.paint({x:this.x0,y:this.y0})}}findParts(x,y){return this.top.findParts(x,y)}}class Parts{constructor(){this._text="",this._next=this._prev=null,this._textwidth=this._textheight=this._width=this._height=0,this._hspace=this._hspace2=0}get x1(){return this._x1}set x1(x){this._x1=x}get y1(){return this._y1}set y1(y){this._y1=y}get x2(){return this._x2}set x2(x){this._x2=x}get y2(){return this._y2}set y2(y){this._y2=y}get text(){return this._text}get next(){return this._next}set next(p){p._next=this.next,p._prev=this,null!=this.next&&(this.next._prev=p),this._next=p}get prev(){return this._prev}get end(){return this}get width(){return this._width}get height(){return this._height}get textWidth(){return this._textwidth}get textHeight(){return this._textheight}get hspace(){return this._hspace}get hspace2(){return this._hspace2}get isBlockEnd(){return!1}inside(x,y){return this.x1<=x&&x<=this.x2&&this.y1<=y&&y<=this.y2}findParts(x,y){for(var p=this;null!=p&&!(p instanceof Parts_Null);){if(p.inside(x,y))return p;if(p instanceof Parts_If){var p1=p.left.findParts(x,y);if(p1)return p1;if(p1=p.right.findParts(x,y))return p1;p=p.end.next}else p=p.next}return null!=p&&null!=p.next?p.next.findParts(x,y):null}paint(position){return null!=this.next?this.next.paint(position):this}calcTextsize(){if(null!=this.text&&""!=this.text){var size=FlowchartSetting.size,metrics=flowchart.context.measureText(this.text);this._hspace=0,this._textwidth=metrics.width,this._textwidth<4*size&&(this._hspace=(4*size-this._textwidth)/2,this._textwidth=4*size),this._textheight=FlowchartSetting.fontsize}}calcSize(p0,p1,p2){return null==this.next||this.isBlockEnd?this:this.next.calcSize(p0,p1,p2)}static appendMe(bar){}appendCode(code,indent){return null!=this.next?this.next.appendCode(code,indent):code}static makeIndent(indent_level){for(var s="",i=0;i<indent_level;i++)s+="    ";return s}editMe(){}deleteMe(){this.prev._next=this.end.next.next,this.end.next.next._prev=this.prev,this.end._next=null,this._next=null}cutMe(){}paint_highlight(){flowchart.context.strokeStyle="rgb(255,0,0)",flowchart.context.fillStyle="rgb(255,0,0)",flowchart.context.clearRect(this.x1,this.y1,this.x2-this.x1,this.y2-this.y1),this.paint(null),flowchart.context.strokeStyle="rgb(0,0,0)",flowchart.context.fillStyle="rgb(0,0,0)"}paint_unhighlight(){flowchart.context.clearRect(this.x1,this.y1,this.x2-this.x1,this.y2-this.y1),this.paint(null)}highlight(){this.paint_highlight()}unhighlight(){this.paint_unhighlight()}}class Parts_Null extends Parts{get isBlockEnd(){return!0}}class Parts_Bar extends Parts{calcSize(p0,p1,p2){return this._width=0,this._height=3*FlowchartSetting.size,p0.y+=this._height,p0.y>p2.y&&(p2.y=p0.y),this.next.calcSize(p0,p1,p2)}inside(x,y){var near=4;return this.x1-4<=x&&x<=this.x2+4&&this.y1<=y&&y<=this.y2}paint(position){return null!=position&&(this.x1=this.x2=position.x,this.y1=position.y,this.y2=this.y1+this.height),flowchart.context.beginPath(),flowchart.context.moveTo(this.x1,this.y1),flowchart.context.lineTo(this.x2,this.y2),flowchart.context.stroke(),null!=position?(position.x=this.x2,position.y=this.y2,this.next.paint(position)):this}}class Parts_Terminal extends Parts{calcSize(p0,p1,p2){this.calcTextsize(),this._height=this._textheight+2*FlowchartSetting.size,this._width=this._textwidth+this._height;var x1=p0.x-this.width/2,x2=p0.x+this.width/2,y2=p0.y+this.height;return x1<p1.x&&(p1.x=x1),x2>p2.x&&(p2.x=x2),y2>p2.y&&(p2.y=y2),p0.y=y2,null==this.next?this:this.next.calcSize(p0,p1,p2)}setValue(v){this._text=v}paint(position){var size=FlowchartSetting.size;return null!=position&&(this.x1=position.x-this.textWidth/2-this.height/2,this.x2=position.x+this.textWidth/2+this.height/2,this.y1=position.y,this.y2=position.y+this.height),flowchart.context.beginPath(),flowchart.context.moveTo(this.x1+this.height/2,this.y1),flowchart.context.lineTo(this.x2-this.height/2,this.y1),flowchart.context.stroke(),flowchart.context.beginPath(),flowchart.context.arc(this.x2-this.height/2,this.y1+this.height/2,this.height/2,Math.PI/2,-Math.PI/2,!0),flowchart.context.stroke(),flowchart.context.beginPath(),flowchart.context.moveTo(this.x1+this.height/2,this.y2),flowchart.context.lineTo(this.x2-this.height/2,this.y2),flowchart.context.stroke(),flowchart.context.beginPath(),flowchart.context.arc(this.x1+this.height/2,this.y1+this.height/2,this.height/2,3*Math.PI/2,Math.PI/2,!0),flowchart.context.stroke(),flowchart.context.fillText(this.text,this.x1+this.height/2,this.y2-FlowchartSetting.size),null!=position?(position.y+=this.height,null!=this.end.next?this.end.next.paint(position):this.end):this}}class Parts_Output extends Parts{constructor(){super(),this.setValue("《値》",!0)}get newline(){return this._newline}setValue(v,nl){this._text=v,this._newline=nl}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this._textheight+2*size,this._width=this._textwidth+2*size+this._height/2;var x1=p0.x-this.width/2,x2=p0.x+this.width/2,y2=p0.y+this.height;return x1<p1.x&&(p1.x=x1),x2>p2.x&&(p2.x=x2),y2>p2.y&&(p2.y=y2),p0.y=y2,this.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;if(null!=position&&(this.x1=position.x-this.width/2,this.x2=position.x+this.width/2,this.y1=position.y,this.y2=this.y1+this.height),flowchart.context.beginPath(),flowchart.context.moveTo(this.x2-this.height/2,this.y1),flowchart.context.lineTo(this.x1+2*size,this.y1),flowchart.context.lineTo(this.x1,(this.y1+this.y2)/2),flowchart.context.lineTo(this.x1+2*size,this.y2),flowchart.context.lineTo(this.x2-this.height/2,this.y2),flowchart.context.stroke(),flowchart.context.beginPath(),flowchart.context.arc(this.x2-this.height/2,(this.y1+this.y2)/2,this.height/2,Math.PI/2,-Math.PI/2,!0),flowchart.context.stroke(),flowchart.context.fillText(this.text,this.x1+2*size+this.hspace,this.y2-size),!this.newline&&"改行"!=this.text){var x=this.x2-this.height/2,y=this.y1+size;flowchart.context.beginPath(),flowchart.context.moveTo(x+size,y),flowchart.context.lineTo(x+size,y+this.textHeight),flowchart.context.lineTo(x,y+this.textHeight),flowchart.context.stroke(),flowchart.context.beginPath(),flowchart.context.moveTo(x+size/2,y+this.textHeight-size/4),flowchart.context.lineTo(x,y+this.textHeight),flowchart.context.lineTo(x+size/2,y+this.textHeight+size/4),flowchart.context.stroke(),x+=this.height/4,y+=this.textHeight/2,flowchart.context.beginPath(),flowchart.context.moveTo(x-size/2,y-size/2),flowchart.context.lineTo(x+size/2,y+size/2),flowchart.context.stroke(),flowchart.context.beginPath(),flowchart.context.moveTo(x+size/2,y-size/2),flowchart.context.lineTo(x-size/2,y+size/2),flowchart.context.stroke()}return null!=position?(position.y=this.y2,null!=this.end.next?this.end.next.paint(position):this.end):this}static appendMe(bar){var parts=new Parts_Output;return bar.next=parts,parts.next=new Parts_Bar,parts.next}appendCode(code,indent){return code+=Parts.makeIndent(indent),"改行"==this.text?code+="改行する\n":code+=this.text+"を"+(this.newline?"":"改行なしで")+"表示する\n",null!=this.next?this.next.appendCode(code,indent):code}editMe(){var subtitle,values;openModalWindowforOutput("出力の編集",["値","改行"],[this.text,this.newline],this)}edited(values){null!=values&&this.setValue(values[0],values[1]),flowchart.paint(),flowchart.flowchart2code()}}class Parts_Input extends Parts{constructor(){super(),this.setValue("《変数》",0)}setValue(v,type){this._var=v,this.type=type,this._text=v+"を入力",this.type>0&&(this._text+="（"+nameOfType[this.type]+"）")}get var(){return this._var}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this._textheight+2*size,this._width=this._textwidth+4*size;var x1=p0.x-this.width/2,x2=p0.x+this.width/2,y2=p0.y+this.height;return x1<p1.x&&(p1.x=x1),x2>p2.x&&(p2.x=x2),y2>p2.y&&(p2.y=y2),p0.y=y2,null==this.next||this.isBlockEnd?this:this.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;return null!=position&&(this.x1=position.x-this.width/2,this.x2=position.x+this.width/2,this.y1=position.y,this.y2=this.y1+this.height),flowchart.context.beginPath(),flowchart.context.moveTo(this.x1,this.y1+size),flowchart.context.lineTo(this.x2,this.y1-size),flowchart.context.lineTo(this.x2,this.y2),flowchart.context.lineTo(this.x1,this.y2),flowchart.context.lineTo(this.x1,this.y1+size),flowchart.context.stroke(),flowchart.context.fillText(this.text,this.x1+2*size,this.y2-size),null!=position?(position.y=this.y2,null!=this.end.next?this.end.next.paint(position):this.end):this}static appendMe(bar){var parts=new Parts_Input;return bar.next=parts,parts.next=new Parts_Bar,parts.next}appendCode(code,indent){return code+=Parts.makeIndent(indent),code+=this.var,this.type>0&&(code+="に"+nameOfType[this.type]),code+="を入力する\n",null!=this.next?this.next.appendCode(code,indent):code}editMe(){var subtitle,values;openModalWindowforInput("入力の編集",["変数","型"],[this.var,this.type],this)}edited(values){null!=values&&this.setValue(values[0],values[1]),flowchart.paint(),flowchart.flowchart2code()}}class Parts_Substitute extends Parts{constructor(){super(),this.setValue("《変数》","《値》",null)}setValue(variable,value,operator){this._var=variable,this._val=value,this._operator=operator,this._text=this._var+(this._operator?this._operator:"")+"←"+this._val}get var(){return this._var}get val(){return this._val}get operator(){return this._operator}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this._textheight+2*size,this._width=this._textwidth+4*size;var x1=p0.x-this.width/2,x2=p0.x+this.width/2,y2=p0.y+this.height;return x1<p1.x&&(p1.x=x1),x2>p2.x&&(p2.x=x2),y2>p2.y&&(p2.y=y2),p0.y=y2,null==this.next||this.isBlockEnd?this:this.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;return null!=position&&(this.x1=position.x-this.width/2,this.x2=position.x+this.width/2,this.y1=position.y,this.y2=this.y1+this.height),flowchart.context.beginPath(),flowchart.context.moveTo(this.x1,this.y1),flowchart.context.lineTo(this.x2,this.y1),flowchart.context.lineTo(this.x2,this.y2),flowchart.context.lineTo(this.x1,this.y2),flowchart.context.lineTo(this.x1,this.y1),flowchart.context.stroke(),flowchart.context.fillText(this.text,this.x1+2*size,this.y2-size),null!=position?(position.y=this.y2,null!=this.end.next?this.end.next.paint(position):this.end):this}static appendMe(bar){var parts=new Parts_Substitute;return bar.next=parts,parts.next=new Parts_Bar,parts.next}appendCode(code,indent){return code+=Parts.makeIndent(indent),code+=this.var+(this.operator?this.operator:"")+"←"+this.val+"\n",null!=this.next?this.next.appendCode(code,indent):code}editMe(){var subtitle,values;openModalWindowforSubstitute("代入の編集",["変数","値","演算"],[this.var,this.val,this.operator],this)}edited(values){null!=values&&("（なし）"==values[2]&&(values[2]=null),this.setValue(values[0],values[1],values[2])),flowchart.paint(),flowchart.flowchart2code()}}class Parts_Append extends Parts{constructor(){super(),this.setValue("《変数》","《値》")}setValue(variable,value){this._var=variable,this._val=value,this._text=this._var+"に"+this._val+"を追加"}get var(){return this._var}get val(){return this._val}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this._textheight+2*size,this._width=this._textwidth+4*size;var x1=p0.x-this.width/2,x2=p0.x+this.width/2,y2=p0.y+this.height;return x1<p1.x&&(p1.x=x1),x2>p2.x&&(p2.x=x2),y2>p2.y&&(p2.y=y2),p0.y=y2,null==this.next||this.isBlockEnd?this:this.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;return null!=position&&(this.x1=position.x-this.width/2,this.x2=position.x+this.width/2,this.y1=position.y,this.y2=this.y1+this.height),flowchart.context.beginPath(),flowchart.context.moveTo(this.x1,this.y1),flowchart.context.lineTo(this.x2,this.y1),flowchart.context.lineTo(this.x2,this.y2),flowchart.context.lineTo(this.x1,this.y2),flowchart.context.lineTo(this.x1,this.y1),flowchart.context.stroke(),flowchart.context.fillText(this.text,this.x1+2*size,this.y2-size),null!=position?(position.y=this.y2,null!=this.end.next?this.end.next.paint(position):this.end):this}static appendMe(bar){var parts=new Parts_Append;return bar.next=parts,parts.next=new Parts_Bar,parts.next}appendCode(code,indent){return code+=Parts.makeIndent(indent),code+=this.var+"に"+this.val+"を追加する\n",null!=this.next?this.next.appendCode(code,indent):code}editMe(){var subtitle,values;openModalWindow("追加の編集",["変数","値"],[this.var,this.val],this)}edited(values){null!=values&&this.setValue(values[0],values[1]),flowchart.paint(),flowchart.flowchart2code()}}class Parts_Extend extends Parts{constructor(){super(),this.setValue("《変数》","《値》")}setValue(variable,value){this._var=variable,this._val=value,this._text=this._var+"に"+this._val+"を連結"}get var(){return this._var}get val(){return this._val}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this._textheight+2*size,this._width=this._textwidth+4*size;var x1=p0.x-this.width/2,x2=p0.x+this.width/2,y2=p0.y+this.height;return x1<p1.x&&(p1.x=x1),x2>p2.x&&(p2.x=x2),y2>p2.y&&(p2.y=y2),p0.y=y2,null==this.next||this.isBlockEnd?this:this.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;return null!=position&&(this.x1=position.x-this.width/2,this.x2=position.x+this.width/2,this.y1=position.y,this.y2=this.y1+this.height),flowchart.context.beginPath(),flowchart.context.moveTo(this.x1,this.y1),flowchart.context.lineTo(this.x2,this.y1),flowchart.context.lineTo(this.x2,this.y2),flowchart.context.lineTo(this.x1,this.y2),flowchart.context.lineTo(this.x1,this.y1),flowchart.context.stroke(),flowchart.context.fillText(this.text,this.x1+2*size,this.y2-size),null!=position?(position.y=this.y2,null!=this.end.next?this.end.next.paint(position):this.end):this}static appendMe(bar){var parts=new Parts_Append;return bar.next=parts,parts.next=new Parts_Bar,parts.next}appendCode(code,indent){return code+=Parts.makeIndent(indent),code+=this.var+"に"+this.val+"を連結する\n",null!=this.next?this.next.appendCode(code,indent):code}editMe(){var subtitle,values;openModalWindow("追加の編集",["変数","値"],[this.var,this.val],this)}edited(values){null!=values&&this.setValue(values[0],values[1]),flowchart.paint(),flowchart.flowchart2code()}}class Parts_If extends Parts{constructor(){super(),this.setValue("《条件》"),this.left=this.right=null,this.left_bar_expand=this.right_bar_expand=0}setValue(cond){this._cond=cond,this._text=this._cond}get condition(){return this._cond}get end(){return this.next}calcTextsize(){if(null!=this.text&&""!=this.text){var size=FlowchartSetting.size,metrics=flowchart.context.measureText(this.text);this._hspace=0,this._textwidth=metrics.width,this._textwidth<6*size&&(this._hspace=(6*size-this._textwidth)/2,this._textwidth=6*size),this._textheight=FlowchartSetting.fontsize}}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this.v_margin=2*size,this.h_margin=this.textWidth*this.textHeight/this.v_margin/4,this._height=this.textHeight+2*this.v_margin,this._width=this.textWidth+2*this.h_margin;var x1=p0.x-this.width/2,x2=p0.x+this.width/2,pl=new point;pl.x=x1,pl.y=p0.y;var pl1=pl.clone(),pl2=pl.clone();this.left.calcSize(pl,pl1,pl2),this.left_bar_expand=pl2.x-pl.x,this.left_bar_expand<size&&(this.left_bar_expand=size),pl1.x-=this.left_bar_expand,pl2.x-=this.left_bar_expand,pl1.x<p1.x&&(p1.x=pl1.x),pl1.y>p1.y&&(p1.y=pl1.y),pl2.y>p1.y&&(p1.y=pl2.y);var pr=new point;pr.x=x2,pr.y=p0.y;var pr1=pr.clone(),pr2=pr.clone();return this.right.calcSize(pr,pr1,pr2),this.right_bar_expand=pr.x-pr1.x,this.right_bar_expand<size&&(this.right_bar_expand=size),pr1.x+=this.right_bar_expand,pr2.x+=this.right_bar_expand,pr2.x>p2.x&&(p2.x=pr2.x),pr1.y>p2.y&&(p2.y=pr1.y),pr2.y>p2.y&&(p2.y=pr2.y),pr1.x<pl2.x+size&&(this.right_bar_expand+=pl2.x-pr1.x+size,p2.x+=pl2.x-pr1.x+size),this.end.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;null!=position&&(this.x1=position.x-this.width/2,this.x2=position.x+this.width/2,this.y1=position.y,this.y2=this.y1+this.height);var x0=(this.x1+this.x2)/2,y0=(this.y1+this.y2)/2;if(flowchart.context.beginPath(),flowchart.context.moveTo(x0,this.y1),flowchart.context.lineTo(this.x1,y0),flowchart.context.lineTo(x0,this.y2),flowchart.context.lineTo(this.x2,y0),flowchart.context.lineTo(x0,this.y1),flowchart.context.stroke(),flowchart.context.fillText(this.text,x0-this.textWidth/2+this.hspace,y0+this.textHeight/2),null!=position){flowchart.context.beginPath(),flowchart.context.moveTo(this.x1,y0),flowchart.context.lineTo(this.x1-this.left_bar_expand,y0),flowchart.context.stroke(),flowchart.context.fillText("Y",this.x1-1*size,y0-size);var left_parts=this.left.paint({x:this.x1-this.left_bar_expand,y:y0}).prev;flowchart.context.beginPath(),flowchart.context.moveTo(this.x2,y0),flowchart.context.lineTo(this.x2+this.right_bar_expand,y0),flowchart.context.stroke(),flowchart.context.fillText("N",this.x2+0*size,y0-size);var right_parts=this.right.paint({x:this.x2+this.right_bar_expand,y:y0}).prev,y;if(left_parts.y2>right_parts.y2?(y=left_parts.y2,flowchart.context.beginPath(),flowchart.context.moveTo(this.x2+this.right_bar_expand,right_parts.y2),flowchart.context.lineTo(this.x2+this.right_bar_expand,y),flowchart.context.stroke(),right_parts.y2=y):(y=right_parts.y2,flowchart.context.beginPath(),flowchart.context.moveTo(this.x1-this.left_bar_expand,left_parts.y2),flowchart.context.lineTo(this.x1-this.left_bar_expand,y),flowchart.context.stroke(),left_parts.y2=y),flowchart.context.beginPath(),flowchart.context.moveTo(this.x1-this.left_bar_expand,y),flowchart.context.lineTo(this.x2+this.right_bar_expand,y),flowchart.context.stroke(),position.y=y,null!=this.end.next)return this.end.next.paint(position)}return this.end.next}static appendMe(bar){var parts=new Parts_If;return bar.next=parts,parts.next=new Parts_Null,parts.next.next=new Parts_Bar,parts.left=new Parts_Bar,parts.left._prev=parts,parts.left.next=new Parts_Null,parts.right=new Parts_Bar,parts.right._prev=parts,parts.right.next=new Parts_Null,parts.end.next.next}appendCode(code,indent){return code+=Parts.makeIndent(indent),code+="もし"+this.condition+"ならば：\n",this.left.next instanceof Parts_Null?code+=Parts.makeIndent(indent+1)+"\n":code+=this.left.appendCode("",indent+1),this.right.next instanceof Parts_Null||(code+=Parts.makeIndent(indent)+"そうでなければ：\n",code+=this.right.appendCode("",indent+1)),null!=this.end.next?this.end.next.appendCode(code,indent):code}editMe(){var subtitle,values;openModalWindow("分岐の編集",["条件"],[this.condition],this)}edited(values){null!=values&&this.setValue(values[0]),flowchart.paint(),flowchart.flowchart2code()}}class Parts_LoopBegin extends Parts{get hasText(){return!1}get end(){return this._end}calcTextsize(){if(this.hasText){var size=FlowchartSetting.size;this._textwidth=6*size,this._hspace=this._hspace2=0;var tw=flowchart.context.measureText(this.text).width;tw>this._textwidth&&(this._textwidth=tw);var tw2=flowchart.context.measureText(this.text2).width;tw2>this._textwidth&&(this._textwidth=tw2),tw<this._textwidth&&(this._hspace=(this._textwidth-tw)/2),tw2<this._textwidth&&(this._hspace2=(this._textwidth-tw2)/2),this._textheight=FlowchartSetting.fontsize}else this.end.calcTextsize(),this._textwidth=this.end.textWidth,this._textheight=this.end.textHeight}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this.textHeight*(this.hasText?2:1)+2*size,this._width=this.textWidth+2*size;var x1=p0.x-this.width/2,x2=p0.x+this.width/2,y2=p0.y+this.height;x1<p1.x&&(p1.x=x1),x2>p2.x&&(p2.x=x2),y2>p2.y&&(p2.y=y2),p0.y=y2;for(var n=this.next;n!=this.end;)n=n.calcSize(p0,p1,p2);return this.end.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;return null!=position&&(this.x1=position.x-this.width/2,this.x2=position.x+this.width/2,this.y1=position.y,this.y2=this.y1+this.height),flowchart.context.beginPath(),flowchart.context.moveTo(this.x1+size,this.y1),flowchart.context.lineTo(this.x2-size,this.y1),flowchart.context.lineTo(this.x2,this.y1+size),flowchart.context.lineTo(this.x2,this.y2),flowchart.context.lineTo(this.x1,this.y2),flowchart.context.lineTo(this.x1,this.y1+size),flowchart.context.lineTo(this.x1+size,this.y1),flowchart.context.stroke(),this.hasText&&(flowchart.context.fillText(this.text,this.x1+size+this.hspace,this.y1+size+this.textHeight),flowchart.context.fillText(this.text2,this.x1+size+this.hspace2,this.y1+size+2*this.textHeight)),null!=position?(position.y=this.y2,this.next.paint(position),this.end.next.paint(position)):this}deleteMe(){this.prev._next=this.end.next.next,this.end.next.next._prev=this.prev,this.end._next=null,this._next=null}highlight(){this.paint_highlight(),this.end.paint_highlight()}unhighlight(){this.paint_unhighlight(),this.end.paint_unhighlight()}}class Parts_LoopBegin1 extends Parts_LoopBegin{get hasText(){return!0}constructor(){super(),this.setValue("《条件》")}setValue(cond){this._cond=cond,this._text=this._cond}get condition(){return this._cond}get text2(){return"の間"}static appendMe(bar){var parts=new Parts_LoopBegin1;return bar.next=parts,parts.next=new Parts_Bar,parts.next.next=new Parts_LoopEnd,parts.next.next.next=new Parts_Bar,parts._end=parts.next.next,parts.next.next._begin=parts,parts.end}appendCode(code,indent){code+=Parts.makeIndent(indent),code+=this.condition+"の間：\n";var code_inner=this.next.appendCode("",indent+1);return code+=""==code_inner?Parts.makeIndent(indent+1)+"\n":code_inner,null!=this.end.next?this.end.next.appendCode(code,indent):code}editMe(){var subtitle,values;openModalWindow("繰り返しの編集",["条件（〜の間）"],[this.condition],this)}edited(values){null!=values&&this.setValue(values[0]),flowchart.paint(),flowchart.flowchart2code()}}class Parts_LoopBeginInc extends Parts_LoopBegin{get hasText(){return!0}constructor(){super(),this.setValue("《変数》","《値》","《値》","《値》")}setValue(variable,start,goal,step){this._var=variable,this._start=start,this._goal=goal,this._step=step,this._text=this.var+":"+this.start+"→"+this.goal}get var(){return this._var}get start(){return this._start}get goal(){return this._goal}get step(){return this._step}get text2(){return this.step+"ずつ増"}static appendMe(bar){var parts=new Parts_LoopBeginInc;return bar.next=parts,parts.next=new Parts_Bar,parts.next.next=new Parts_LoopEnd,parts.next.next.next=new Parts_Bar,parts._end=parts.next.next,parts.next.next._begin=parts,parts.end}appendCode(code,indent){code+=Parts.makeIndent(indent),code+=this.var+"を"+this.start+"から"+this.goal+"まで"+this.step+"ずつ増やしながら：\n";var code_inner=this.next.appendCode("",indent+1);return code+=""==code_inner?Parts.makeIndent(indent+1)+"\n":code_inner,null!=this.end.next?this.end.next.appendCode(code,indent):code}editMe(){var subtitle,values;openModalWindow("繰り返しの編集",["変数","〜から","〜まで","増加分"],[this.var,this.start,this.goal,this.step],this)}edited(values){null!=values&&this.setValue(values[0],values[1],values[2],values[3]),flowchart.paint(),flowchart.flowchart2code()}}class Parts_LoopBeginDec extends Parts_LoopBegin{get hasText(){return!0}constructor(){super(),this.setValue("《変数》","《値》","《値》","《値》")}setValue(variable,start,goal,step){this._var=variable,this._start=start,this._goal=goal,this._step=step,this._text=this.var+":"+this.start+"→"+this.goal}get var(){return this._var}get start(){return this._start}get goal(){return this._goal}get step(){return this._step}get text2(){return this.step+"ずつ減"}static appendMe(bar){var parts=new Parts_LoopBeginDec;return bar.next=parts,parts.next=new Parts_Bar,parts.next.next=new Parts_LoopEnd,parts.next.next.next=new Parts_Bar,parts._end=parts.next.next,parts.next.next._begin=parts,parts.end}appendCode(code,indent){code+=Parts.makeIndent(indent),code+=this.var+"を"+this.start+"から"+this.goal+"まで"+this.step+"ずつ減らしながら：\n";var code_inner=this.next.appendCode("",indent+1);return code+=""==code_inner?Parts.makeIndent(indent+1)+"\n":code_inner,null!=this.end.next?this.end.next.appendCode(code,indent):code}editMe(){var subtitle,values;openModalWindow("繰り返しの編集",["変数","〜から","〜まで","減少分"],[this.var,this.start,this.goal,this.step],this)}edited(values){null!=values&&this.setValue(values[0],values[1],values[2],values[3]),flowchart.paint(),flowchart.flowchart2code()}}class Parts_LoopEnd extends Parts{get hasText(){return!1}get begin(){return this._begin}get isBlockEnd(){return!0}editMe(){this.begin.editMe()}calcTextsize(){if(this.hasText){var size=FlowchartSetting.size;this._textwidth=6*size,this._hspace=this._hspace2=0;var tw=flowchart.context.measureText(this.text).width;tw>this._textwidth&&(this._textwidth=tw);var tw2=flowchart.context.measureText(this.text2).width;tw2>this._textwidth&&(this._textwidth=tw2),tw<this._textwidth&&(this._hspace=(this._textwidth-tw)/2),tw2<this._textwidth&&(this._hspace2=(this._textwidth-tw2)/2),this._textheight=FlowchartSetting.fontsize,this._textheight=FlowchartSetting.fontsize}else this._textwidth=this.begin.textWidth,this._textheight=this.begin.textHeight}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this.textHeight*(this.hasText?2:1)+2*size,this._width=this.textWidth+2*size;var x1=p0.x-this.width/2,x2=p0.x+this.width/2,y2=p0.y+this.height;return x1<p1.x&&(p1.x=x1),x2>p2.x&&(p2.x=x2),y2>p2.y&&(p2.y=y2),p0.y=y2,this}paint(position){var size=FlowchartSetting.size;return null!=position&&(this.x1=position.x-this.width/2,this.x2=position.x+this.width/2,this.y1=position.y,this.y2=this.y1+this.height),flowchart.context.beginPath(),flowchart.context.moveTo(this.x1,this.y1),flowchart.context.lineTo(this.x2,this.y1),flowchart.context.lineTo(this.x2,this.y2-size),flowchart.context.lineTo(this.x2-size,this.y2),flowchart.context.lineTo(this.x1+size,this.y2),flowchart.context.lineTo(this.x1,this.y2-size),flowchart.context.lineTo(this.x1,this.y1),flowchart.context.stroke(),this.hasText&&(flowchart.context.fillText(this.text,this.x1+size+this.hspace,this.y1+size+this.textHeight),flowchart.context.fillText(this.text2,this.x1+size+this.hspace2,this.y1+size+2*this.textHeight)),null!=position&&(position.y=this.y2),this}appendCode(code,indent){return code}editMe(){this.begin.editMe()}deleteMe(){this.begin.deleteMe()}cutMe(){this.begin.cutMe()}highlight(){this.paint_highlight(),this.begin.paint_highlight()}unhighlight(){this.paint_unhighlight(),this.begin.paint_unhighlight()}}var misc_menu_ja=[["《各種処理》","none","《各種処理》",[]],["何もしない","NopStatement","何もしない",[]],["描画領域開く","gOpenWindow","描画領域開く(\t,\t)",["幅","高さ"]],["描画領域閉じる","gCloseWindow","描画領域閉じる()",[]],["描画領域全消去","gClearWindow","描画領域全消去()",[]],["線色設定","gSetLineColor","線色設定(\t,\t,\t)",["赤","青","緑"]],["塗色設定","gSetFillColor","塗色設定(\t,\t,\t)",["赤","青","緑"]],["文字色設定","gSetTextColor","文字色設定(\t,\t,\t)",["赤","青","緑"]],["線太さ設定","gSetLineWidth","線太さ設定(\t)",["太さ"]],["文字サイズ設定","gSetFontSize","文字サイズ設定(\t)",["サイズ"]],["文字描画","gDrawText","文字描画(\t,\t,\t)",["文字列","x","y"]],["点描画","gDrawPoint","点描画(\t,\t,\t,\t)",["x","y"]],["線描画","gDrawLine","線描画(\t,\t,\t,\t)",["x1","y1","x2","y2"]],["矩形描画","gDrawBox","矩形描画(\t,\t,\t,\t)",["x","y","幅","高さ"]],["矩形塗描画","gFillBox","矩形塗描画(\t,\t,\t,\t)",["x","y","幅","高さ"]],["円描画","gDrawCircle","円描画(\t,\t,\t)",["x","y","半径"]],["円塗描画","gFillCircle","円塗描画(\t,\t,\t)",["x","y","半径"]],["楕円描画","gDrawCircle","楕円描画(\t,\t,\t,\t)",["x","y","幅","高さ"]],["楕円塗描画","gFillCircle","楕円塗描画(\t,\t,\t,\t)",["x","y","幅","高さ"]],["弧描画","gDrawArc","弧描画(\t,\t,\t,\t,\t,\t,\t)",["x","y","幅","高さ","開始角","終了角","閉じ方"]],["弧塗描画","gFillArc","弧塗描画(\t,\t,\t,\t,\t,\t,\t)",["x","y","幅","高さ","開始角","終了角","閉じ方"]],["棒グラフ描画","gBarplot","棒グラフ描画(\t,\t,\t)",["幅","高さ","配列"]],["線グラフ描画","gLineplot","線グラフ描画(\t,\t,\t)",["幅","高さ","配列"]],["グラフ描画","gDrawGraph","グラフ描画(\t,\t)",["レイアウト情報","値の配列"]],["グラフ消去","gClearGraph","グラフ消去()",[]],["待つ","sleep","\tミリ秒待つ",["ミリ秒数"]],["繰り返しを抜ける","break","繰り返しを抜ける",[]],["変数を確認する","dump","変数を確認する",[]],["一時停止する","PauseStatement","一時停止する",[]]],misc_menu_en=[["《各種処理》","none","《各種処理》",[]],["何もしない","NopStatement","何もしない",[]],["gOpenWindow","gOpenWindow","gOpenWindow(\t,\t)",["幅","高さ"]],["gCloseWindow","gCloseWindow","gCloseWindow()",[]],["gClearWindow","gClearWindow","gClearWindow()",[]],["gSetLineColor","gSetLineColor","gSetLineColor(\t,\t,\t)",["赤","青","緑"]],["gSetFillColor","gSetFillColor","gSetFillColor(\t,\t,\t)",["赤","青","緑"]],["gSetTextColor","gSetTextColor","gSetTextColor(\t,\t,\t)",["赤","青","緑"]],["gSetLineWidth","gSetLineWidth","gSetLineWidth(\t)",["太さ"]],["gSetFontSize","gSetFontSize","gSetFontSize(\t)",["サイズ"]],["gDrawText","gDrawText","gDrawText(\t,\t,\t)",["文字列","x","y"]],["gDrawPoint","gDrawPoint","gDrawPoint(\t,\t,\t,\t)",["x","y"]],["gDrawLine","gDrawLine","gDrawLine(\t,\t,\t,\t)",["x1","y1","x2","y2"]],["gDrawBox","gDrawBox","gDrawBox(\t,\t,\t,\t)",["x","y","幅","高さ"]],["gFillBox","gFillBox","gFillBox(\t,\t,\t,\t)",["x","y","幅","高さ"]],["gDrawCircle","gDrawCircle","gDrawCicle(\t,\t,\t)",["x","y","半径"]],["gFillCircle","gFillCircle","gFillCircle(\t,\t,\t)",["x","y","半径"]],["gDrawOval","gDrawCircle","gDrawOval(\t,\t,\t,\t)",["x","y","幅","高さ"]],["gFillOval","gFillCircle","gFillOval(\t,\t,\t,\t)",["x","y","幅","高さ"]],["gDrawArc","gDrawArc","gDrawArc(\t,\t,\t,\t,\t,\t,\t)",["x","y","幅","高さ","開始角","終了角","閉じ方"]],["gFillArc","gFillArc","gFillArc(\t,\t,\t,\t,\t,\t,\t)",["x","y","幅","高さ","開始角","終了角","閉じ方"]],["gBarplot","gBarplot","gBarplot(\t,\t,\t)",["幅","高さ","値"]],["gLineplot","gLineplot","gLineplot(\t,\t,\t)",["幅","高さ","値"]],["gDrawGraph","gDrawGraph","gDrawGraph(\t,\t)",["レイアウト情報","値の配列"]],["gClearGraph","gClearGraph","gClearGraph()",,[]],["待つ","sleep","\tミリ秒待つ",["ミリ秒数"]],["繰り返しを抜ける","break","繰り返しを抜ける",[]],["変数を確認する","dump","変数を確認する",[]],["一時停止する","PauseStatement","一時停止する",[]]],misc_menu=0==setting.graphic_command?misc_menu_ja:misc_menu_en,modal_title,modal_subtitle,modal_values,modal_parts,misc_identifier;class Parts_Misc extends Parts{constructor(){super(),this.setValue("none",[])}setValue(identifier,values){this._identifier=identifier,this._values=[];for(var i=0;i<values.length;i++)this._values.push(values[i].getCode());for(var i=0;i<misc_menu.length;i++)if(this._identifier==misc_menu[i][1]){this._command=misc_menu[i][0];for(var code=misc_menu[i][2],j=0;j<this.values.length;j++)code=code.replace("\t",this.values[j]);this._text=code;break}}setValuebyText(identifier,values){this._identifier=identifier,this._values=[];for(var i=0;i<values.length;i++)this._values.push(values[i]);for(var i=0;i<misc_menu.length;i++)if(this._identifier==misc_menu[i][1]){this._command=misc_menu[i][0];for(var code=misc_menu[i][2],j=0;j<this.values.length;j++)code=code.replace("\t",this.values[j]);this._text=code;break}}get identifier(){return this._identifier}get values(){return this._values}calcSize(p0,p1,p2){this.calcTextsize();var size=FlowchartSetting.size;this._height=this._textheight+2*size,this._width=this._textwidth+4*size;var x1=p0.x-this.width/2,x2=p0.x+this.width/2,y2=p0.y+this.height;return x1<p1.x&&(p1.x=x1),x2>p2.x&&(p2.x=x2),y2>p2.y&&(p2.y=y2),p0.y=y2,null==this.next||this.isBlockEnd?this:this.next.calcSize(p0,p1,p2)}paint(position){var size=FlowchartSetting.size;return null!=position&&(this.x1=position.x-this.width/2,this.x2=position.x+this.width/2,this.y1=position.y,this.y2=this.y1+this.height),flowchart.context.beginPath(),flowchart.context.moveTo(this.x1,this.y1),flowchart.context.lineTo(this.x2,this.y1),flowchart.context.lineTo(this.x2,this.y2),flowchart.context.lineTo(this.x1,this.y2),flowchart.context.lineTo(this.x1,this.y1),flowchart.context.stroke(),flowchart.context.fillText(this.text,this.x1+2*size,this.y2-size),null!=position?(position.y=this.y2,null!=this.end.next?this.end.next.paint(position):this.end):this}static appendMe(bar){var parts=new Parts_Misc;return bar.next=parts,parts.next=new Parts_Bar,parts.next}appendCode(code,indent){return code+=Parts.makeIndent(indent),code+=this.text+"\n",null!=this.next?this.next.appendCode(code,indent):code}editMe(){openModalWindowforMisc(this)}edited(identifier,values){null!=values&&this.setValuebyText(identifier,values),flowchart.paint(),flowchart.flowchart2code()}}function openModalWindow(title,subtitle,values,parts){var html="<p>"+title+"</p>";modal_subtitle=subtitle,modal_values=values,modal_parts=parts,html+="<table>";for(var i=0;i<modal_subtitle.length;i++)html+="<tr><td>"+subtitle[i]+'</td><td><input type="text" id="inputarea'+i+'" value="'+values[i].replace(/\"/g,"&quot;")+'" onfocus="select();" onkeydown="keydownModal(event);" spellcheck="false"></td></tr>';html+="</table>",html+='<button type="button" onclick="closeModalWindow(true);">OK</button>',html+='<button type="button" onclick="closeModalWindow(false);">キャンセル</button>',modal_parts.highlight(),$("#input").html(html),$("#input").height(100+30*subtitle.length),$("#input-overlay").fadeIn(),$("#input").fadeIn(),$("#inputarea0").focus()}function openModalWindowforSubstitute(title,subtitle,values,parts){var operator=values[2]?values[2]:"（なし）",operators=["（なし）","+","-","*","/","//","%","&","|","<<",">>"],html="<p>"+title+"</p>";modal_subtitle=subtitle,modal_values=values,modal_parts=parts,html+="<table>",html+="<tr><td>"+subtitle[0]+'</td><td><input type="text" id="inputarea0" value="'+values[0].replace(/\"/g,"&quot;")+'" onfocus="select();" onkeydown="keydownModal(event);" spellcheck="false"></td></tr>',html+="<tr><td>"+subtitle[1]+'</td><td><input type="text" id="inputarea1" value="'+values[1].replace(/\"/g,"&quot;")+'" onfocus="select();" onkeydown="keydownModal(event);" spellcheck="false"></td></tr>',html+="<tr><td>"+subtitle[2]+'</td><td><select id="inputarea2">';for(var i=0;i<=operators.length;i++)html+='<option value="'+operators[i]+'"'+(operator==operators[i]?'selected="selected"':"")+">"+operators[i]+"</option>";html+="</td></tr>",html+="</table>",html+='<button type="button" onclick="closeModalWindow(true);">OK</button>',html+='<button type="button" onclick="closeModalWindow(false);">キャンセル</button>',modal_parts.highlight(),$("#input").html(html),$("#input").height(100+40*subtitle.length),$("#input-overlay").fadeIn(),$("#input").fadeIn(),$("#inputarea0").focus()}function openModalWindowforInput(title,subtitle,values,parts){var html="<p>"+title+"</p>";modal_subtitle=subtitle,modal_values=values,modal_parts=parts,html+="<table>",html+="<tr><td>"+subtitle[0]+'</td><td><input type="text" id="inputarea0" value="'+values[0].replace(/\"/g,"&quot;")+'" onfocus="select();" onkeydown="keydownModal(event);" spellcheck="false"></td></tr>',html+="<tr><td>"+subtitle[1]+'</td><td><select id="inputarea1">';for(var i=typeOfValue.typeInt;i<=typeOfValue.typeBoolean;i++)html+='<option value="'+i+'"'+(i==values[1]?'selected="selected"':"")+">"+nameOfType[i]+"</option>";html+="</td></tr>",html+="</table>",html+='<button type="button" onclick="closeModalWindow(true);">OK</button>',html+='<button type="button" onclick="closeModalWindow(false);">キャンセル</button>',modal_parts.highlight(),$("#input").html(html),$("#input").height(100+40*subtitle.length),$("#input-overlay").fadeIn(),$("#input").fadeIn(),$("#inputarea0").focus()}function openModalWindowforOutput(title,subtitle,values,parts){var html="<p>"+title+"</p>";modal_subtitle=subtitle,modal_values=values,modal_parts=parts,html+="<table>",html+="<tr><td>"+subtitle[0]+'</td><td><input type="text" id="inputarea0" value="'+values[0].replace(/\"/g,"&quot;")+'" onfocus="select();" onkeydown="keydownModal(event);" spellcheck="false"></td></tr>',html+='<tr><td></td><td><input type="checkbox" id="inputarea1"'+(values[1]?' checked="checked"':"")+">改行する</td></tr>",html+="</table>",html+='<button type="button" onclick="closeModalWindow(true);">OK</button>',html+='<button type="button" onclick="closeModalWindow(false);">キャンセル</button>',modal_parts.highlight(),$("#input").html(html),$("#input").height(100+40*subtitle.length),$("#input-overlay").fadeIn(),$("#input").fadeIn(),$("#inputarea0").focus()}function closeModalWindow(ok){if(ok)for(var i=0;i<modal_subtitle.length;i++){var $j=$("#inputarea"+i);"checkbox"==$j.prop("type")?modal_values[i]=$j.prop("checked"):modal_values[i]=$j.val()}$("#input").hide(),$("#input-overlay").hide(),modal_parts.unhighlight(),ok&&makeDirty(!0),modal_parts.edited(ok?modal_values:null)}function keydownModal(e){var evt=e||window.event;27==evt.keyCode?closeModalWindow(!1):13==evt.keyCode&&(evt.preventDefault(),closeModalWindow(!0))}function openModalWindowforMisc(parts){var html="<p>各種処理の編集</p>";modal_parts=parts,modal_values=[];for(var i=0;i<parts.values.length;i++)modal_values.push(parts.values[i]);html+='<select id="misccommands" onchange="onmiscchanged();">';for(var i=0;i<misc_menu.length;i++)html+='<option value="'+misc_menu[i][1]+'"'+(misc_menu[i][1]==parts.identifier?" selected":"")+">"+misc_menu[i][0]+"</option>";html+="</select>",html+='<table id="miscvalues">',html+="</table>",html+='<button type="button" onclick="closeModalWindowforMisc(true);">OK</button>',html+='<button type="button" onclick="closeModalWindowforMisc(false);">キャンセル</button>',modal_parts.highlight(),$("#input").html(html),$("#input-overlay").fadeIn(),$("#input").fadeIn(),setIdentifierforMisc(parts.identifier)}function onmiscchanged(){var index=document.getElementById("misccommands").selectedIndex;setIdentifierforMisc(misc_menu[index][1])}function setIdentifierforMisc(identifier){misc_identifier=identifier;for(var i=0;i<modal_values.length;i++){var elem=document.getElementById("inputarea"+i);elem&&(modal_values[i]=elem.value),/《.*》/.test(modal_values[i])&&(modal_values[i]=null)}for(var table=document.getElementById("miscvalues");table.firstChild;)table.removeChild(table.firstChild);for(var i=0;i<misc_menu.length;i++)if(identifier==misc_menu[i][1]){for(var tmp_values=[],j=0;j<misc_menu[i][3].length;j++){var v="《"+misc_menu[i][3][j]+"》";modal_values.length>j&&null!=modal_values[j]?v=modal_values[j]:modal_parts.values.length>j&&null!=modal_parts.values[j]&&(v=modal_parts.values[j]),tmp_values.push(v);var tr=document.createElement("tr"),td=document.createElement("td");td.innerHTML=misc_menu[i][3][j],tr.appendChild(td),td=document.createElement("td");var input=document.createElement("input");input.setAttribute("id","inputarea"+j),input.setAttribute("value",v),input.setAttribute("onfocus","select();"),input.setAttribute("onkeydown","keydownModalforMisc(event);"),input.setAttribute("spellcheck","false"),td.appendChild(input),tr.appendChild(td),table.appendChild(tr)}modal_values=tmp_values}$("#input").height(120+35*modal_values.length)}function closeModalWindowforMisc(ok){if(ok)for(var i=0;i<modal_values.length;i++)modal_values[i]=document.getElementById("inputarea"+i).value;$("#input").hide(),$("#input-overlay").hide(),modal_parts.unhighlight(),modal_parts.edited(misc_identifier,ok?modal_values:null)}function keydownModalforMisc(e){var evt=e||window.event;27==evt.keyCode?closeModalWindowforMisc(!1):13==evt.keyCode&&closeModalWindowforMisc(!0)}function cmBackspace(cm){var pos=cm.getCursor(),code,lines,code1=cm.getValue().split(/\r|\n|\r\n/)[pos.line].slice(0,pos.ch);/^\s+$/.exec(code1)?cm.execCommand("indentLess"):cm.execCommand("delCharBefore")}function cmCtrlRight(cm){var pos=cm.getCursor(),code,lines=cm.getValue().split(/\r|\n|\r\n/),selected=cm.getSelection(),ch=pos.ch;selected&&(ch+=selected.length);var code2=lines[pos.line].slice(ch),find=/《[^《]*》/.exec(code2);if(find){var ch1=ch+find.index,ch2=ch1+find[0].length;cm.setSelection({line:pos.line,ch:ch2},{line:pos.line,ch:ch1})}else cm.execCommand("goLineEnd")}function cmCtrlLeft(cm){var pos=cm.getCursor(),code,lines,code1=cm.getValue().split(/\r|\n|\r\n/)[pos.line].slice(0,pos.ch),re1=new RegExp("《[^《]*》","g"),find=re1.exec(code1);if(find){do{var ch1=find.index,ch2=ch1+find[0].length;find=re1.exec(code1)}while(re1.lastIndex>0);cm.setSelection({line:pos.line,ch:ch2},{line:pos.line,ch:ch1})}else/^\s*$/.exec(code1)?cm.execCommand("goLineStart"):cm.execCommand("goLineStartSmart")}onload=function(){var sourceTextArea=document.getElementById("sourceTextarea"),resultTextArea=document.getElementById("resultTextarea"),newButton=document.getElementById("newButton"),runButton=document.getElementById("runButton"),flowchartButton=document.getElementById("flowchartButton"),resetButton=document.getElementById("resetButton"),stepButton=document.getElementById("stepButton"),dumpButton=document.getElementById("dumpButton"),loadButton=document.getElementById("loadButton"),file_prefix=document.getElementById("file_prefix"),flowchart_canvas=document.getElementById("flowchart");(editor=CodeMirror.fromTextArea(sourceTextArea,{mode:{name:"pypen"},lineNumbers:!0,lineWrapping:!0,indentUnit:4,indentWithTabs:!1,extraKeys:{Tab:"indentMore","Shift-Tab":"indentLess",Backspace:cmBackspace,"Ctrl-Left":cmCtrlLeft,"Ctrl-Right":cmCtrlRight}})).setSize(500,300),editor.on("change",(function(){editor.save(),makeDirty(!0)})),resultTextArea.style.width=document.getElementById("input_area").clientWidth+"px",new ResizeObserver((function(){var w=editor.getWrapperElement().width,h=resultTextArea.offsetHeight-4;editor.setSize(w,h),editor.refresh()})).observe(resultTextArea),editor.getWrapperElement().id="CMSourceTextArea",editor.getWrapperElement().addEventListener("mousedown",mouseClick),editor.getWrapperElement().addEventListener("keyup",keyUp),sourceTextArea.onchange=function(){makeDirty(!0)},makeDirty(!1),textarea=resultTextArea,runButton.onclick=function(){run_flag&&!step_flag?(setRunflag(!1),document.getElementById("sourceTextarea").readOnly=!0,editor.options.readOnly=!0,editor.getWrapperElement().classList.add("readonly"),dumpButton.disabled=!1):(step_flag=!1,dumpButton.disabled=!0,run())},stepButton.onclick=function(){step_flag=!0,run()},newButton.onclick=function(){dirty&&!window.confirm("プログラムを削除していいですか？")||(editor.setValue(""),code=null,reset(),flowchart&&(flowchart.makeEmpty(),flowchart.paint()),editor.focus(),makeDirty(!1))},resetButton.onclick=function(){reset()},dumpButton.onclick=function(){dump()},loadButton.addEventListener("change",(function(ev){var file=ev.target.files,reader=new FileReader;reader.readAsText(file[0],"UTF-8"),reader.onload=function(ev){editor.setValue(reader.result),reset(),flowchart&&codeChange()}}),!1),downloadLink.onclick=function(){var now=new Date,filename=file_prefix.value.trim();filename.length<1&&(filename=now.getFullYear()+("0"+(now.getMonth()+1)).slice(-2)+("0"+now.getDate()).slice(-2)+"_"+("0"+now.getHours()).slice(-2)+("0"+now.getMinutes()).slice(-2)+("0"+now.getSeconds()).slice(-2)),filename+=".PyPEN";var blob=new Blob([editor.getValue()],{type:"text/plain"});window.navigator.msSaveBlob?window.navigator.msSaveBlob(blob,filename):(window.URL=window.URL||window.webkitURL,downloadLink.setAttribute("href",window.URL.createObjectURL(blob)),downloadLink.setAttribute("download",filename)),makeDirty(!1)},flowchartButton.onchange=function(){flowchart_display=this.checked;var flowchart_area=document.getElementById("Flowchart_area"),drawButton=document.getElementById("drawButton");flowchart_display?(flowchart_area.style.display="block",drawButton.style.display="inline",flowchart=new Flowchart,codeChange()):(flowchart_area.style.display="none",drawButton.style.display="none",flowchart=null)},flowchartButton.click(),editor.getWrapperElement().ondrop=function(e){var filelist=e.dataTransfer.files;if(filelist){for(var i=0;i<filelist.length;i++)if(/\.PyPEN$/i.exec(filelist[i].name)&&window.FileReader)try{var reader=new FileReader;reader.readAsText(filelist[i]),reader.onload=function(event){editor.setValue(event.target.result),codeChange()};break}catch(e){}return!1}},registerEvent(flowchart_canvas,"mousedown",mouseDown),registerEvent(flowchart_canvas,"mouseup",mouseUp),registerEvent(flowchart_canvas,"mousemove",mouseMove),registerEvent(flowchart_canvas,"dblclick",doubleclick_Flowchart),$.contextMenu({selector:"#CMSourceTextArea",zIndex:2,items:{zenkaku:{name:"入力補助",items:{"かつ":{name:"かつ",callback:function(k,e){insertCode("《値》 かつ 《値》")}},"または":{name:"または",callback:function(k,e){insertCode("《値》 または 《値》")}},"でない":{name:"でない",callback:function(k,e){insertCode("《値》 でない")}},"と":{name:"と",callback:function(k,e){insertCode("《値》と《値》")}}}},convert:{name:"変換",items:{int:{name:"整数",callback:function(k,e){insertCode("整数(《値》)")}},float:{name:"実数",callback:function(k,e){insertCode("実数(《値》)")}},string:{name:"文字列",callback:function(k,e){insertCode("文字列(《値》)")}},bool:{name:"真偽",callback:function(k,e){insertCode("真偽(《値》)")}}}},math:{name:"数学関数",items:{abs:{name:"abs 絶対値",callback:function(k,e){insertCode("abs(《値》)")}},random:{name:"random 乱数",callback:function(k,e){insertCode("random(《整数》)")}},ceil:{name:"ceil 切り上げ",callback:function(k,e){insertCode("ceil(《実数》)")}},floor:{name:"floor 切り捨て",callback:function(k,e){insertCode("floor(《実数》)")}},round:{name:"round 四捨五入",callback:function(k,e){insertCode("round(《実数》)")}},sin:{name:"sin サイン",callback:function(k,e){insertCode("sin(《実数》)")}},cos:{name:"cos コサイン",callback:function(k,e){insertCode("cos(《実数》)")}},tan:{name:"tan タンジェント",callback:function(k,e){insertCode("tan(《実数》)")}},sqrt:{name:"sqrt ルート",callback:function(k,e){insertCode("sqrt(《実数》)")}},log:{name:"log 自然対数",callback:function(k,e){insertCode("log(《実数》)")}},exp:{name:"exp 指数関数",callback:function(k,e){insertCode("exp(《実数》)")}},pow:{name:"pow 累乗",callback:function(k,e){insertCode("pow(《実数》,《実数》)")}}}},str:{name:"文字列関数",items:{length:{name:"length 長さ",callback:function(k,e){insertCode("length(《文字列》)")}},append:{name:"append 文字列結合",callback:function(k,e){insertCode("append(《文字列》,《文字列》)")}},substring1:{name:"substring 部分文字列（最後まで）",callback:function(k,e){insertCode("substring(《文字列》,《開始位置》)")}},substring2:{name:"substring 部分文字列（長さ指定）",callback:function(k,e){insertCode("substring(《文字列》,《開始位置》,《長さ》)")}},split:{name:"split 文字列分割",callback:function(k,e){insertCode("split(《文字列》,《区切文字列》)")}},extract:{name:"extract 文字列分割（番号指定）",callback:function(k,e){insertCode("extract(《文字列》,《区切文字列》,《番号》)")}},insert:{name:"insert 挿入",callback:function(k,e){insertCode("insert(《文字列》,《位置》,《文字列》)")}},replace:{name:"replace 置換",callback:function(k,e){insertCode("replace(《文字列》,《位置》,《長さ》,《文字列》)")}}}},graphic1:{name:"グラフィック命令（日本語）",items:{gOpenWindow:{name:"描画領域開く",callback:function(k,e){insertCode("描画領域開く(《幅》,《高さ》)")}},gCloseWindow:{name:"描画領域閉じる",callback:function(k,e){insertCode("描画領域閉じる()")}},gClearWindow:{name:"描画領域全消去",callback:function(k,e){insertCode("描画領域全消去()")}},gSetLineColor:{name:"線色設定",callback:function(k,e){insertCode("線色設定(《赤》,《緑》,《青》)")}},gSetFillColor:{name:"塗色設定",callback:function(k,e){insertCode("塗色設定(《赤》,《緑》,《青》)")}},gSetTextColor:{name:"文字色設定",callback:function(k,e){insertCode("文字色設定(《赤》,《緑》,《青》)")}},gSetLineWidth:{name:"線太さ設定",callback:function(k,e){insertCode("線太さ設定(《太さ》)")}},gSetFontSize:{name:"文字サイズ設定",callback:function(k,e){insertCode("文字サイズ設定(《サイズ》)")}},gDrawText:{name:"文字描画",callback:function(k,e){insertCode("文字描画(《文字列》,《x》,《y》)")}},gDrawPoint:{name:"点描画",callback:function(k,e){insertCode("点描画(《x》,《y》)")}},gDrawLine:{name:"線描画",callback:function(k,e){insertCode("線描画(《x1》,《y1》,《x2》,《y2》)")}},gDrawBox:{name:"矩形描画",callback:function(k,e){insertCode("矩形描画(《x》,《y》,《幅》,《高さ》)")}},gFillBox:{name:"矩形塗描画",callback:function(k,e){insertCode("矩形塗描画(《x》,《y》,《幅》,《高さ》)")}},gDrawCircle:{name:"円描画",callback:function(k,e){insertCode("円描画(《x》,《y》,《半径》)")}},gFillCircle:{name:"円塗描画",callback:function(k,e){insertCode("円塗描画(《x》,《y》,《半径》)")}},gDrawOval:{name:"楕円描画",callback:function(k,e){insertCode("楕円描画(《x》,《y》,《幅》,《高さ》)")}},gFillOval:{name:"楕円塗描画",callback:function(k,e){insertCode("楕円塗描画(《x》,《y》,《幅》,《高さ》)")}},gDrawArc:{name:"弧描画",callback:function(k,e){insertCode("弧描画(《x》,《y》,《幅》,《高さ》,《開始角》,《終了角》,《閉じ方》)")}},gFillArc:{name:"弧塗描画",callback:function(k,e){insertCode("弧塗描画(《x》,《y》,《幅》,《高さ》,《開始角》,《終了角》,《閉じ方》)")}},gBarplot:{name:"棒グラフ描画",callback:function(k,e){insertCode("棒グラフ描画(《幅》,《高さ》,《値》)")}},gLineplot:{name:"線グラフ描画",callback:function(k,e){insertCode("線グラフ描画(《幅》,《高さ》,《値》)")}},gDrawGraph:{name:"グラフ描画",callback:function(k,e){insertCode("グラフ描画(《レイアウト情報》,《値の配列》)")}},gClearGraph:{name:"グラフ消去",callback:function(k,e){insertCode("グラフ消去()")}}}},graphic2:{name:"グラフィック命令（英語）",items:{gOpenWindow:{name:"gOpenWindow",callback:function(k,e){insertCode("gOpenWindow(《幅》,《高さ》)")}},gCloseWindow:{name:"gCloseWindow",callback:function(k,e){insertCode("gCloseWindow()")}},gClearWindow:{name:"gClearWindow",callback:function(k,e){insertCode("gClearWindow()")}},gSetLineColor:{name:"gSetLineColor",callback:function(k,e){insertCode("gSetLineColor(《赤》,《緑》,《青》)")}},gSetFillColor:{name:"gSetFillColor",callback:function(k,e){insertCode("gSetFillColor(《赤》,《緑》,《青》)")}},gSetTextColor:{name:"gSetTextColor",callback:function(k,e){insertCode("gSetTextColor(《赤》,《緑》,《青》)")}},gSetLineWidth:{name:"gSetLineWidth",callback:function(k,e){insertCode("gSetLineWidth(《太さ》)")}},gSetFontSize:{name:"gSetFontSize",callback:function(k,e){insertCode("gSetFontSize(《サイズ》)")}},gDrawText:{name:"gDrawText",callback:function(k,e){insertCode("gDraeText(《文字列》,《x》,《y》)")}},gDrawPoint:{name:"gDrawPoint",callback:function(k,e){insertCode("gDrawPoint(《x》,《y》)")}},gDrawLine:{name:"gDrawLine",callback:function(k,e){insertCode("gDrawLine(《x1》,《y1》,《x2》,《y2》)")}},gDrawBox:{name:"gDrawBox",callback:function(k,e){insertCode("gDrawBox(《x》,《y》,《幅》,《高さ》)")}},gFillBox:{name:"gFillBox",callback:function(k,e){insertCode("gFillBox(《x》,《y》,《幅》,《高さ》)")}},gDrawCircle:{name:"gDrawCircle",callback:function(k,e){insertCode("gDrawCircle(《x》,《y》,《半径》)")}},gFillCircle:{name:"gFillCircle",callback:function(k,e){insertCode("gFillCircle(《x》,《y》,《半径》)")}},gDrawOval:{name:"gDrawOval",callback:function(k,e){insertCode("gDrawOval(《x》,《y》,《幅》,《高さ》)")}},gFillOval:{name:"gFillOval",callback:function(k,e){insertCode("gFillOval(《x》,《y》,《幅》,《高さ》)")}},gDrawArc:{name:"gDrawArc",callback:function(k,e){insertCode("gDrawArc(《x》,《y》,《幅》,《高さ》,《開始角》,《終了角》,《閉じ方》)")}},gFillArc:{name:"gFillArc",callback:function(k,e){insertCode("gFillArc(《x》,《y》,《幅》,《高さ》,《開始角》,《終了角》,《閉じ方》)")}},gBarplot:{name:"gBarplot",callback:function(k,e){insertCode("gBarplot(《幅》,《高さ》,《値》)")}},gLineplot:{name:"gLineplot",callback:function(k,e){insertCode("gLineplot(《幅》,《高さ》,《値》)")}},gDrawGraph:{name:"gDrawGraph",callback:function(k,e){insertCode("gDrawGraph(《レイアウト情報》,《値の配列》)")}},gClearGraph:{name:"gClearGraph",callback:function(k,e){insertCode("gClearGraph()")}}}},misc:{name:"各種命令",items:{nop:{name:"何もしない",callback:function(k,e){insertCode("何もしない")}},sleep:{name:"待つ",callback:function(k,e){insertCode("《ミリ秒数》ミリ秒待つ")}},dump:{name:"変数を確認する",callback:function(k,e){insertCode("変数を確認する")}},pause:{name:"一時停止する",callback:function(k,e){insertCode("一時停止する")}}}}}}),$.contextMenu({selector:"#flowchart",build:contextMenu_Flowchart});var messageName="zero-timeout-message";function setZeroTimeout(fn){timeouts.push(fn),window.postMessage(messageName,"*")}function handleMessage(event){var fn;event.source==window&&event.data==messageName&&(event.stopPropagation(),timeouts.length>0&&timeouts.shift()())}window.addEventListener?window.addEventListener("message",handleMessage,!0):window.attachEvent&&window.attachEvent("onmessage",handleMessage),window.setZeroTimeout=setZeroTimeout,$(window).bind("beforeunload",(function(){if(dirty)return"プログラムが消去されます"})),reset();let sample_area=document.getElementById("SampleButtons"),sample_table=document.createElement("table");sample_area.appendChild(sample_table);let sample_table_row=null;for(let i=0;i<sample.length;i++){sample_table_row||(sample_table_row=document.createElement("tr"),sample_table.appendChild(sample_table_row));let cell=document.createElement("td"),button=document.createElement("button");button.innerText="サンプル"+(i+1),button.setAttribute("type","button"),button.setAttribute("class","sampleButton"),button.onclick=function(){sampleButton(i)},cell.appendChild(button),sample_table_row.appendChild(cell),i%8==7&&(sample_table_row=null)}if(1==setting.quiz_mode&&Quizzes.length>0){let quiz_select=document.getElementById("quiz_select");quiz_select.onchange=function(){let i=quiz_select.selectedIndex;document.getElementById("quiz_question").innerHTML=i>0?Quizzes[i-1].question():""};let option=document.createElement("option");option.val=0,option.appendChild(document.createTextNode("問題選択")),quiz_select.appendChild(option);for(let i=0;i<Quizzes.length;i++)option=document.createElement("option"),option.val=i+1,option.appendChild(document.createTextNode("Q"+(i+1)+":"+Quizzes[i].title())),quiz_select.appendChild(option);document.getElementById("quiz_marking").onclick=function(){let i=quiz_select.selectedIndex;i>0?auto_marking(i-1):textarea.value="問題が選択されていないので採点できません。"}}else document.getElementById("Quiz_area").style.display="none";document.getElementById("urlButton").onclick=function(){var code=sourceTextArea.value.trim();if(""!=code&&(code=B64encode(code))){var url=window.location;textareaClear(),highlightLine(-1),textareaAppend(url.protocol+"//"+url.hostname+url.pathname+"?code="+code)}};var code=getParam("code");code&&(editor.setValue(code),codeChange(),highlightLine(-1))};var base64str="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function B64encode(string){var textencoder=new TextEncoder,deflate,origin=new Zlib.Deflate(textencoder.encode(string)).compress();if(origin.length>1500)return textareaAppend("*** プログラムが大きすぎて変換できません ***"),null;for(var convert=new Array(4*Math.floor((origin.length+2)/3)),i=0;i<origin.length;i+=3){var v1,v2,v3=64,v4=64;v1=origin[i]>>>2,v2=48&origin[i]<<4,i+1<origin.length&&(v2|=15&origin[i+1]>>>4,v3=60&origin[i+1]<<2,i+2<origin.length&&(v3|=3&origin[i+2]>>>6,v4=63&origin[i+2]));var j=i/3*4;convert[j++]=base64str[v1],convert[j++]=base64str[v2],convert[j++]=base64str[v3],convert[j]=base64str[v4]}return convert.join("").replace(/=+$/,"")}function B64decode(string){var convert=new Array;try{for(var i=0;i<string.length;i+=4){var c1=base64str.indexOf(string[i]),c2=base64str.indexOf(string[i+1]),c3,c4;convert.push(c1<<2|c2>>4),i+2<string.length&&(c3=base64str.indexOf(string[i+2]),convert.push((15&c2)<<4|c3>>>2),i+3<string.length&&(c4=base64str.indexOf(string[i+3]),convert.push((3&c3)<<6|c4)))}var inflate=new Zlib.Inflate(convert),textdecoder;return(new TextDecoder).decode(inflate.decompress())}catch(e){return""}}function getParam(name){var getparam=window.location.search;if(getparam){var params=getparam.slice(1).split("&");for(var param of params){var p=param.split("=");if(p[0]==name)return B64decode(p[1])}}return null}function auto_marking(i){reset(),setRunflag(!0),document.getElementById("runButton").disabled=!0,document.getElementById("stepButton").disabled=!0,document.getElementById("resetButton").disabled=!0,document.getElementById("urlButton").disabled=!0,highlightLine(-1),textareaClear(),textareaAppend("*** 採点開始 ***\n"),selected_quiz=i;let all_clear=!0;for(let j=0;j<Quizzes[i].cases();j++){let clear=!0;textareaAppend("ケース"+(j+1)+"...");try{if(selected_quiz_case=j,test_limit_time=Date.now()+Quizzes[selected_quiz].timeout(),run(),selected_quiz_input!=Quizzes[selected_quiz].inputs(selected_quiz_case).length)throw new RuntimeError(-1,"入力の回数がおかしいです。");if(output_str.trim()!=Quizzes[selected_quiz].output(selected_quiz_case).toString().trim())throw new RuntimeError(-1,"結果が違います。");textareaAppend("成功\n")}catch(e){textareaAppend("失敗\n"),textareaAppend(e.message+"\n"),clear=!1}all_clear&=clear,code=null}textareaAppend(all_clear?"*** 合格 ***\n":"--- 不合格 ---\n"),selected_quiz=-1,document.getElementById("runButton").disabled=!1,document.getElementById("stepButton").disabled=!1,document.getElementById("resetButton").disabled=!1,document.getElementById("urlButton").disabled=!1,setRunflag(!1)}function font_size(updown){if(0!=updown){if(fontsize+updown<14||fontsize+updown>30)return;fontsize+=updown}else fontsize=16;var elem=document.getElementById("CMSourceTextArea");elem.style.fontSize=fontsize+"px",(elem=document.getElementsByClassName("CodeMirror-cursor")[0]).style.fontSize=fontsize+"px",editor.refresh(),(elem=textarea).style.fontSize=fontsize+"px",editor.focus()}function makePython(){if(!run_flag){code=null,myFuncs={},python_lib={};try{var code=editor.getValue(),dncl_code=python_to_dncl(code),main_routine,python_code=new parsedMainRoutine(dncl.parse(dncl_code)).makePython();textareaClear(),textareaAppend(python_code)}catch(e){highlightLine(-1),textareaClear(),e.line&&textareaAppend(e.line+"行目"),textareaAppend("構文エラーです\n"+e.message)}}}